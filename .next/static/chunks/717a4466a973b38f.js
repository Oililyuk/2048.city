(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68978,t=>{"use strict";class e{size;grid;score;bestScore;stateHistory;maxHistorySize;initialUndoCount;undoCount;maxUndoCount;undoRewardValue;tileContainer;scoreDisplay;bestScoreDisplay;messageContainer;startX;startY;endX;endY;tiles;tileId;randomSeed;random;isAnimating;isDragging;dragStartX;dragStartY;currentDragX;currentDragY;dragDirection;dragDistance;previewOffset;minDragDistance;dragThreshold;dragStartTime;quickSwipeThreshold;quickSwipeEnabled;lastTouchMoveTime;touchMoveThrottle;dragPreviewEnabled;keydownHandler;onGameEnd;onScoreUpdate;constructor(){this.size=4,this.grid=[],this.score=0,this.bestScore=localStorage.getItem("bestScore")||0,this.stateHistory=[],this.maxHistorySize=100,this.initialUndoCount=3,this.undoCount=this.initialUndoCount,this.maxUndoCount=10,this.undoRewardValue=256,this.tileContainer=document.getElementById("tile-container"),this.scoreDisplay=document.getElementById("score"),this.bestScoreDisplay=document.getElementById("best-score"),this.messageContainer=document.getElementById("game-message"),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.tiles={},this.tileId=0,this.randomSeed=Date.now(),this.random=this.createSeededRandom(this.randomSeed),this.isAnimating=!1,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.currentDragX=0,this.currentDragY=0,this.dragDirection=null,this.dragDistance=0,this.previewOffset={x:0,y:0},this.minDragDistance=30,this.dragThreshold=3,this.dragStartTime=0,this.quickSwipeThreshold=300,this.quickSwipeEnabled=!0,this.lastTouchMoveTime=0,this.touchMoveThrottle=32,this.dragPreviewEnabled=!0,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&window.innerWidth<=400&&(this.dragPreviewEnabled=!0),this.setup(),this.updateDisplay(),this.preventPageScroll(),this.fixViewportHeight()}preventPageScroll(){}fixViewportHeight(){let t=()=>{let t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)};t(),window.addEventListener("resize",t),window.addEventListener("orientationchange",t)}setup(){for(let t=0;t<this.size;t++){this.grid[t]=[];for(let e=0;e<this.size;e++)this.grid[t][e]=null}this.addNewTile(),this.addNewTile(),this.saveState(),this.setupEventListeners(),this.bestScoreDisplay.textContent=this.bestScore,this.updateUndoButton(),this.startLiquidAnimation()}createSeededRandom(t){let e=t;return{random:()=>(e=(1664525*e+0x3c6ef35f)%0x7fffffff)/0x7fffffff,getSeed:()=>e,setSeed:t=>{e=t}}}setupEventListeners(){this.keydownHandler||(this.keydownHandler=t=>{let e={37:"left",65:"left",38:"up",87:"up",39:"right",68:"right",40:"down",83:"down"}[t.keyCode];e&&(t.preventDefault(),this.move(e)),57===t.keyCode&&(t.preventDefault(),this.showMessage("You Win!","game-won")),48===t.keyCode&&(t.preventDefault(),this.showMessage("Game Over","game-stuck"))}),document.removeEventListener("keydown",this.keydownHandler),document.addEventListener("keydown",this.keydownHandler),document.addEventListener("touchstart",t=>{t.target.closest("button")||this.isAnimating||(this.isDragging=!0,this.dragStartX=t.touches[0].clientX,this.dragStartY=t.touches[0].clientY,this.currentDragX=this.dragStartX,this.currentDragY=this.dragStartY,this.dragDirection=null,this.dragDistance=0,this.dragStartTime=Date.now(),Object.values(this.tiles).some(t=>{let e=t.style.transform;return e&&""!==e&&"translate(0, 0) scale(1) rotate(0deg)"!==e})&&this.forceResetAllTiles(),this.tileContainer.classList.add("dragging-active"))},{passive:!0}),document.addEventListener("touchmove",t=>{if(!this.isDragging||this.isAnimating)return;let e=Date.now();if(e-this.lastTouchMoveTime<this.touchMoveThrottle)return;this.lastTouchMoveTime=e;let i=t.touches[0].clientX,s=t.touches[0].clientY,r=i-this.dragStartX,a=s-this.dragStartY;this.currentDragX=i,this.currentDragY=s;let n=Math.abs(r),o=Math.abs(a);(n>this.dragThreshold||o>this.dragThreshold)&&(t.preventDefault(),n>o?(this.dragDirection=r>0?"right":"left",this.dragDistance=n):(this.dragDirection=a>0?"down":"up",this.dragDistance=o),!(e-this.dragStartTime<this.quickSwipeThreshold&&this.dragDistance>this.minDragDistance)&&this.quickSwipeEnabled&&this.dragPreviewEnabled&&this.updateDragPreview(r,a))},{passive:!1}),document.addEventListener("touchend",t=>{if(!this.isDragging)return;this.isDragging=!1,this.tileContainer.classList.remove("dragging-active");let e=Date.now()-this.dragStartTime<this.quickSwipeThreshold,i=e?.5*this.minDragDistance:this.minDragDistance;this.dragDirection&&this.dragDistance>i?e&&this.quickSwipeEnabled?(Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging"),t.style.transition="none",t.style.transform=""}),this.tileContainer.offsetHeight,Object.values(this.tiles).forEach(t=>{t.style.transition=""}),this.move(this.dragDirection)):this.transitionFromDragToMove(this.dragDirection):e?this.forceResetAllTiles():this.resetTileTransforms()},{passive:!0}),document.addEventListener("touchcancel",t=>{this.isDragging&&(this.isDragging=!1,this.tileContainer.classList.remove("dragging-active"),this.resetTileTransforms())},{passive:!0});let t=!1;document.addEventListener("mousedown",e=>{e.target.closest("button")||this.isAnimating||(t=!0,this.isDragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.currentDragX=this.dragStartX,this.currentDragY=this.dragStartY,this.dragDirection=null,this.dragDistance=0,this.dragStartTime=Date.now(),this.forceResetAllTiles(),this.tileContainer.classList.add("dragging-active"))}),document.addEventListener("mousemove",e=>{if(!t||!this.isDragging||this.isAnimating)return;let i=e.clientX-this.dragStartX,s=e.clientY-this.dragStartY;this.currentDragX=e.clientX,this.currentDragY=e.clientY;let r=Math.abs(i),a=Math.abs(s);(r>this.dragThreshold||a>this.dragThreshold)&&(r>a?(this.dragDirection=i>0?"right":"left",this.dragDistance=r):(this.dragDirection=s>0?"down":"up",this.dragDistance=a),this.updateDragPreview(i,s))}),document.addEventListener("mouseup",e=>{if(!t)return;t=!1,this.isDragging=!1,this.tileContainer.classList.remove("dragging-active");let i=Date.now()-this.dragStartTime<this.quickSwipeThreshold,s=i?.5*this.minDragDistance:this.minDragDistance;this.dragDirection&&this.dragDistance>s?i&&this.quickSwipeEnabled?(Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging"),t.style.transition="none",t.style.transform=""}),this.tileContainer.offsetHeight,Object.values(this.tiles).forEach(t=>{t.style.transition=""}),this.move(this.dragDirection)):this.transitionFromDragToMove(this.dragDirection):i?this.forceResetAllTiles():this.resetTileTransforms()})}handleSwipe(){let t=this.endX-this.startX,e=this.endY-this.startY;Math.abs(t)>Math.abs(e)?Math.abs(t)>30&&(t>0?this.move("right"):this.move("left")):Math.abs(e)>30&&(e>0?this.move("down"):this.move("up"))}move(t){if(this.isAnimating||this.isDragging)return;Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging")});let e=[],i=[],s=!1,r=[];for(let t=0;t<this.size;t++){r[t]=[];for(let e=0;e<this.size;e++)r[t][e]=null}if("left"===t)for(let t=0;t<this.size;t++){let a=this.processLine(this.getRow(t),t,0,0,1);s=a.moved||s,e.push(...a.movements),i.push(...a.merges),this.setRow(r,t,a.line)}else if("right"===t)for(let t=0;t<this.size;t++){let a=this.processLine(this.getRow(t).reverse(),t,3,0,-1);s=a.moved||s,e.push(...a.movements),i.push(...a.merges),this.setRow(r,t,a.line.reverse())}else if("up"===t)for(let t=0;t<this.size;t++){let a=this.processLine(this.getColumn(t),0,t,1,0);s=a.moved||s,e.push(...a.movements),i.push(...a.merges),this.setColumn(r,t,a.line)}else if("down"===t)for(let t=0;t<this.size;t++){let a=this.processLine(this.getColumn(t).reverse(),3,t,-1,0);s=a.moved||s,e.push(...a.movements),i.push(...a.merges),this.setColumn(r,t,a.line.reverse())}s&&(this.isAnimating=!0,this.grid=r,this.animateMovements(e,i,()=>{this.addNewTile(),this.saveState(),this.updateDisplay(),this.isAnimating=!1,this.checkWin()?this.showMessage("You Win!","game-won"):this.checkGameOver()&&(0===this.undoCount?this.showMessage("Game Over","game-over"):this.showMessage("Game Over","game-stuck"),this.onGameEnd&&this.onGameEnd(this.score,!1))}))}processLine(t,e,i,s,r){let a=[],n=[],o=[],l=!1,h=[];for(let e=0;e<t.length;e++)null!==t[e]&&h.push({tile:t[e],originalIndex:e});let d=0,c=0;for(;c<h.length;){let t=h[c],g=e+t.originalIndex*s,u=i+t.originalIndex*r,m=e+d*s,f=i+d*r;if((g!==m||u!==f)&&(a.push({tile:t.tile,from:{row:g,col:u},to:{row:m,col:f}}),l=!0),c+1<h.length&&t.tile.value===h[c+1].tile.value&&!t.tile.merged){let d={id:this.tileId++,value:2*t.tile.value,merged:!0},g=h[c+1],u=e+g.originalIndex*s,p=i+g.originalIndex*r;a.push({tile:g.tile,from:{row:u,col:p},to:{row:m,col:f}}),n.push({tiles:[t.tile,g.tile],result:d,position:{row:m,col:f}}),o.push(d),this.score+=d.value,l=!0,d.value>=this.undoRewardValue&&d.value%this.undoRewardValue==0&&this.earnUndoReward(),c+=2}else o.push(t.tile),c+=1;d++}for(;o.length<this.size;)o.push(null);return{line:o,moved:l,movements:a,merges:n}}getRow(t){return this.grid[t].slice()}setRow(t,e,i){t[e]=i}getColumn(t){let e=[];for(let i=0;i<this.size;i++)e.push(this.grid[i][t]);return e}setColumn(t,e,i){for(let s=0;s<this.size;s++)t[s][e]=i[s]}animateMovements(t,e,i){Object.values(this.tiles).forEach(t=>{t.style.transform&&(t.style.transform="")}),t.forEach(t=>{let e=this.tiles[t.tile.id];if(e){let{top:i,left:s}=this.getPosition(t.to.row,t.to.col);e.style.top=i,e.style.left=s}}),setTimeout(()=>{e.forEach(t=>{t.tiles.forEach(t=>{this.tiles[t.id]&&(this.tiles[t.id].remove(),delete this.tiles[t.id])}),this.createTileElement(t.position.row,t.position.col,t.result,!1,!0)}),e.length>0&&this.liquidBurst(),this.scoreDisplay.textContent=this.score,this.score>this.bestScore&&(this.bestScore=this.score,this.bestScoreDisplay.textContent=this.bestScore,localStorage.setItem("bestScore",this.bestScore)),setTimeout(i,30)},120)}addNewTile(){let t=[];for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++)null===this.grid[e][i]&&t.push({row:e,col:i});if(t.length>0){let e=t[Math.floor(this.random.random()*t.length)],i=.9>this.random.random()?2:4,s={id:this.tileId++,value:i,merged:!1};this.grid[e.row][e.col]=s,this.createTileElement(e.row,e.col,s,!0,!1)}}updateDisplay(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)this.grid[t][e]&&this.grid[t][e].merged&&(this.grid[t][e].merged=!1);this.scoreDisplay.textContent=this.score,this.updateUndoButton()}earnUndoReward(){this.undoCount<this.maxUndoCount&&(this.undoCount++,this.showUndoReward())}showUndoReward(){let t=document.createElement("div");t.className="undo-reward",t.textContent="+1 Undo",document.querySelector(".score-container").appendChild(t),setTimeout(()=>{t.remove()},1e3)}updateUndoButton(){let t=document.querySelector(".btn-undo");if(t){let e=t.querySelector(".liquidGlass-content");e&&(e.textContent=`Undo (${this.undoCount})`),this.undoCount>0&&this.stateHistory.length>1?(t.disabled=!1,t.classList.remove("disabled")):(t.disabled=!0,t.classList.add("disabled"))}}createTileElement(t,e,i,s=!1,r=!1,a=!1){let n=document.createElement("div");n.className=`tile liquidGlass-wrapper tile-${i.value}`,n.id=`tile-${i.id}`,s&&n.classList.add("tile-new"),r&&n.classList.add("tile-merged"),a&&n.classList.add("tile-reappear");let o=document.createElement("div");o.className="liquidGlass-effect";let l=document.createElement("div");l.className="liquidGlass-tint";let h=document.createElement("div");h.className="liquidGlass-shine";let d=document.createElement("div");d.className="liquidGlass-text",d.textContent=i.value,n.appendChild(o),n.appendChild(l),n.appendChild(h),n.appendChild(d);let{top:c,left:g}=this.getPosition(t,e);n.style.top=c,n.style.left=g,this.tileContainer.appendChild(n),this.tiles[i.id]=n}getPosition(t,e){let i=window.innerWidth<=520?8:10,s=`(100% - ${3*i}px) / 4`;return{top:`calc(${s} * ${t} + ${i}px * ${t})`,left:`calc(${s} * ${e} + ${i}px * ${e})`}}checkWin(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(this.grid[t][e]&&2048===this.grid[t][e].value)return!0;return!1}checkGameOver(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(null===this.grid[t][e])return!1;for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let i=this.grid[t][e];if(i&&(e<this.size-1&&this.grid[t][e+1]&&i.value===this.grid[t][e+1].value||t<this.size-1&&this.grid[t+1][e]&&i.value===this.grid[t+1][e].value))return!1}return!0}saveState(){let t={grid:JSON.parse(JSON.stringify(this.grid)),score:this.score,undoCount:this.undoCount,randomSeed:this.random.getSeed(),tileId:this.tileId};if(this.stateHistory.length>0){let e=this.stateHistory[this.stateHistory.length-1];if(e.score===t.score&&e.tileId===t.tileId)return}this.stateHistory.push(t),this.stateHistory.length>this.maxHistorySize&&this.stateHistory.shift()}undo(){if(!this.isAnimating&&this.undoCount>0&&this.stateHistory.length>1){this.isAnimating=!0;let t=JSON.parse(JSON.stringify(this.grid));this.stateHistory.pop();let e=this.stateHistory[this.stateHistory.length-1],i=this.calculateUndoAnimations(t,e.grid);this.animateUndo(i,()=>{this.grid=JSON.parse(JSON.stringify(e.grid)),this.score=e.score,this.random.setSeed(e.randomSeed),this.tileId=e.tileId,this.undoCount--,this.updateDisplay(),this.updateUndoButton(),this.isAnimating=!1})}}calculateUndoAnimations(t,e){let i={movements:[],disappears:[],appears:[]},s=new Map,r=new Map;for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++)t[e][i]&&s.set(t[e][i].id,{tile:t[e][i],row:e,col:i});for(let t=0;t<this.size;t++)for(let i=0;i<this.size;i++)e[t][i]&&r.set(e[t][i].id,{tile:e[t][i],row:t,col:i});return r.forEach((t,e)=>{let r=s.get(e);r?(r.row!==t.row||r.col!==t.col)&&i.movements.push({tile:t.tile,from:{row:r.row,col:r.col},to:{row:t.row,col:t.col}}):i.appears.push({tile:t.tile,position:{row:t.row,col:t.col}})}),s.forEach((t,e)=>{r.has(e)||i.disappears.push({tile:t.tile,position:{row:t.row,col:t.col}})}),i}animateUndo(t,e){t.disappears.forEach(t=>{let e=this.tiles[t.tile.id];e&&e.classList.add("tile-disappear")}),t.movements.forEach(t=>{let e=this.tiles[t.tile.id];if(e){let{top:i,left:s}=this.getPosition(t.to.row,t.to.col);e.style.top=i,e.style.left=s}}),setTimeout(()=>{t.disappears.forEach(t=>{let e=this.tiles[t.tile.id];e&&(e.remove(),delete this.tiles[t.tile.id])}),this.tileContainer.innerHTML="",this.tiles={};let i=this.stateHistory[this.stateHistory.length-1];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)if(i.grid[e][s]){let r=t.appears.some(t=>t.tile.id===i.grid[e][s].id);this.createTileElement(e,s,i.grid[e][s],!1,!1,r)}setTimeout(e,50)},150)}restart(){this.tileContainer.innerHTML="",this.tiles={},this.grid=[],this.score=0,this.stateHistory=[],this.undoCount=this.initialUndoCount,this.tileId=0,this.randomSeed=Date.now(),this.random=this.createSeededRandom(this.randomSeed),this.hideMessage(),this.setup()}showMessage(t,e){this.messageContainer.innerHTML="";let i=document.createElement("p");if(i.textContent=t,this.messageContainer.appendChild(i),this.messageContainer.className="game-message "+e,"game-stuck"===e){let t=document.createElement("div");t.className="message-buttons";let e=document.createElement("button");e.className="restart-button",e.textContent=`Undo (${this.undoCount})`,e.onclick=()=>{this.hideMessage(),this.undo()};let i=document.createElement("button");i.className="restart-button",i.textContent="Try Again",i.onclick=()=>game.restart(),t.appendChild(e),t.appendChild(i),this.messageContainer.appendChild(t)}else if("game-won"!==e&&"game-over"!==e){let t=document.createElement("button");t.className="restart-button",t.textContent="Try Again",t.onclick=()=>game.restart(),this.messageContainer.appendChild(t)}else{let t=document.createElement("button");t.className="restart-button",t.textContent="Try Again",t.onclick=()=>game.restart(),this.messageContainer.appendChild(t)}this.messageContainer.style.display="flex",this.messageContainer.style.alignItems="center",this.messageContainer.style.justifyContent="center",this.messageContainer.style.flexDirection="column"}hideMessage(){this.messageContainer.style.display="none",this.messageContainer.className="game-message"}startLiquidAnimation(){}liquidBurst(){let t=document.querySelector("#liquid-burst feDisplacementMap");if(!t)return;let e=t.getAttribute("scale");t.setAttribute("scale","60"),setTimeout(()=>{t.setAttribute("scale",e)},300)}updateDragPreview(t,e){let i=this.tileContainer.offsetWidth/4+10,s=3.5*i,r=0,a=0;"left"===this.dragDirection||"right"===this.dragDirection?(r=Math.max(-s,Math.min(s,.7*t)),a=0):("up"===this.dragDirection||"down"===this.dragDirection)&&(r=0,a=Math.max(-s,Math.min(s,.7*e)));for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let s=this.grid[t][e];if(s&&this.tiles[s.id]){let n=this.tiles[s.id];if(this.canTileMove(t,e,this.dragDirection)){n.classList.contains("dragging")||n.classList.add("dragging");let s=Math.min(this.dragDistance/this.minDragDistance,1),o=s<.5?1.5*s:this.easeOutCubic(s),l=0;"left"===this.dragDirection?l=e*i:"right"===this.dragDirection?l=(this.size-1-e)*i:"up"===this.dragDirection?l=t*i:"down"===this.dragDirection&&(l=(this.size-1-t)*i);let h="left"===this.dragDirection||"right"===this.dragDirection?r:a,d=Math.sign(h)*Math.min(Math.abs(h*o),.9*l),c="left"===this.dragDirection||"right"===this.dragDirection?d:0,g="up"===this.dragDirection||"down"===this.dragDirection?d:0,u=Math.max(0,(s-.2)/.8),m=1+.02*u,f=("left"===this.dragDirection?-1:"right"===this.dragDirection?1:"up"===this.dragDirection?-.5:.5)*u*2;n.style.transform=`translate(${c}px, ${g}px) scale(${m}) rotate(${f}deg)`}else n.classList.remove("dragging"),n.style.transform="translate(0, 0) scale(1) rotate(0deg)"}}}easeOutCubic(t){return 1-Math.pow(1-t,3)}resetTileTransforms(){Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging"),t.classList.remove("moving"),t.style.transition="transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)",t.style.transform="translate(0, 0) scale(1) rotate(0deg)"})}forceResetAllTiles(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let i=this.grid[t][e];if(i&&this.tiles[i.id]){let s=this.tiles[i.id],{top:r,left:a}=this.getPosition(t,e);s.classList.remove("dragging","moving"),s.style.transition="none",s.style.transform="translate(0, 0) scale(1) rotate(0deg)",s.style.top=r,s.style.left=a,s.offsetHeight,s.style.transition=""}}Object.keys(this.tiles).forEach(t=>{let e=!1;for(let i=0;i<this.size&&!e;i++)for(let s=0;s<this.size&&!e;s++)this.grid[i][s]&&this.grid[i][s].id===parseInt(t)&&(e=!0);!e&&this.tiles[t]&&(this.tiles[t].remove(),delete this.tiles[t])})}animateTilesToTarget(t,e){this.isAnimating=!0;let i=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){let r=this.grid[e][s];if(r&&this.tiles[r.id]&&this.canTileMove(e,s,t)){let a=this.tiles[r.id],n=this.calculateMovement(e,s,t);n&&i.push({element:a,from:{row:e,col:s},to:n.to,distance:n.distance,willMerge:n.willMerge})}}let s=this.tileContainer.offsetWidth/4+10;i.forEach(e=>{let i=e.element,r=e.distance*s,a=0,n=0;switch(t){case"left":a=-r;break;case"right":a=r;break;case"up":n=-r;break;case"down":n=r}i.classList.remove("dragging"),i.style.transition="transform 0.12s cubic-bezier(0.25, 0.46, 0.45, 0.94)",i.style.transform=`translate(${a}px, ${n}px)`,e.willMerge&&(i.style.transform+=" scale(0.95)")}),setTimeout(()=>{this.resetTileTransforms(),this.isAnimating=!1,e&&e()},120)}calculateMovement(t,e,i){let s=this.grid[t][e];if(!s)return null;let r=t,a=e,n=0,o=!1;if("left"===i)for(let i=e-1;i>=0;i--)if(null===this.grid[t][i])a=i,n++;else if(this.grid[t][i].value!==s.value||this.grid[t][i].merged)break;else{a=i,n++,o=!0;break}else if("right"===i)for(let i=e+1;i<this.size;i++)if(null===this.grid[t][i])a=i,n++;else if(this.grid[t][i].value!==s.value||this.grid[t][i].merged)break;else{a=i,n++,o=!0;break}else if("up"===i)for(let i=t-1;i>=0;i--)if(null===this.grid[i][e])r=i,n++;else if(this.grid[i][e].value!==s.value||this.grid[i][e].merged)break;else{r=i,n++,o=!0;break}else if("down"===i)for(let i=t+1;i<this.size;i++)if(null===this.grid[i][e])r=i,n++;else if(this.grid[i][e].value!==s.value||this.grid[i][e].merged)break;else{r=i,n++,o=!0;break}return n>0?{to:{row:r,col:a},distance:n,willMerge:o}:null}canTileMove(t,e,i){if(!this.grid[t][e])return!1;switch(i){case"left":return e>0;case"right":return e<this.size-1;case"up":return t>0;case"down":return t<this.size-1;default:return!1}}transitionFromDragToMove(t){this.isAnimating=!0,Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging")});let e={};Object.keys(this.tiles).forEach(t=>{let i=this.tiles[t],s=window.getComputedStyle(i).transform;e[t]=s});let i=[],s=[],r=!1,a=[];for(let t=0;t<this.size;t++){a[t]=[];for(let e=0;e<this.size;e++)a[t][e]=null}if("left"===t)for(let t=0;t<this.size;t++){let e=this.processLine(this.getRow(t),t,0,0,1);r=e.moved||r,i.push(...e.movements),s.push(...e.merges),this.setRow(a,t,e.line)}else if("right"===t)for(let t=0;t<this.size;t++){let e=this.processLine(this.getRow(t).reverse(),t,3,0,-1);r=e.moved||r,i.push(...e.movements),s.push(...e.merges),this.setRow(a,t,e.line.reverse())}else if("up"===t)for(let t=0;t<this.size;t++){let e=this.processLine(this.getColumn(t),0,t,1,0);r=e.moved||r,i.push(...e.movements),s.push(...e.merges),this.setColumn(a,t,e.line)}else if("down"===t)for(let t=0;t<this.size;t++){let e=this.processLine(this.getColumn(t).reverse(),3,t,-1,0);r=e.moved||r,i.push(...e.movements),s.push(...e.merges),this.setColumn(a,t,e.line.reverse())}r?(this.grid=a,this.animateFromCurrentPosition(i,s,()=>{this.addNewTile(),this.saveState(),this.updateDisplay(),this.isAnimating=!1,this.checkWin()?this.showMessage("你赢了!","game-won"):this.checkGameOver()&&(0===this.undoCount?this.showMessage("游戏结束","game-over"):this.showMessage("无路可走!","game-stuck"))})):(this.resetTileTransforms(),setTimeout(()=>{this.isAnimating=!1},200))}animateFromCurrentPosition(t,e,i){Object.values(this.tiles).forEach(t=>{t.classList.remove("dragging"),t.classList.add("moving")});let s=this.tileContainer.offsetWidth/4+10,r=new Set;t.forEach(t=>{let e=this.tiles[t.tile.id];if(e){r.add(t.tile.id);let i=t.to.row-t.from.row,a=t.to.col-t.from.col;e.style.transform=`translate(${a*s}px, ${i*s}px)`}}),Object.entries(this.tiles).forEach(([t,e])=>{r.has(t)||(e.style.transform="translate(0, 0) scale(1) rotate(0deg)",e.classList.remove("moving"))}),setTimeout(()=>{t.forEach(t=>{let e=this.tiles[t.tile.id];if(e){let{top:i,left:s}=this.getPosition(t.to.row,t.to.col);e.style.transition="none",e.style.transform="translate(0, 0) scale(1) rotate(0deg)",e.style.top=i,e.style.left=s,e.offsetHeight,e.style.transition="",e.classList.remove("moving")}}),e.forEach(t=>{t.tiles.forEach(t=>{this.tiles[t.id]&&(this.tiles[t.id].remove(),delete this.tiles[t.id])}),this.createTileElement(t.position.row,t.position.col,t.result,!1,!0)}),e.length>0&&this.liquidBurst(),this.scoreDisplay.textContent=this.score,this.score>this.bestScore&&(this.bestScore=this.score,this.bestScoreDisplay.textContent=this.bestScore,localStorage.setItem("bestScore",this.bestScore)),setTimeout(()=>{this.forceResetAllTiles(),i()},30)},120)}}t.s(["Game2048",()=>e])}]);