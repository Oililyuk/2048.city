{"version":3,"sources":["../../../../src/components/Game/game-logic.ts"],"sourcesContent":["// @ts-nocheck\n// 全局变量\nconst touchStartX: number | null = null;\nconst touchStartY: number | null = null;\nconst animationId: number | null = null;\n\nclass Game2048 {\n    size: number;\n    grid: any[][];\n    score: number;\n    bestScore: any;\n    stateHistory: any[];\n    maxHistorySize: number;\n    initialUndoCount: number;\n    undoCount: number;\n    maxUndoCount: number;\n    undoRewardValue: number;\n    tileContainer: HTMLElement | null;\n    scoreDisplay: HTMLElement | null;\n    bestScoreDisplay: HTMLElement | null;\n    messageContainer: HTMLElement | null;\n    startX: number;\n    startY: number;\n    endX: number;\n    endY: number;\n    tiles: Record<string, any>;\n    tileId: number;\n    randomSeed: number;\n    random: { random: () => number; getSeed: () => number; setSeed: (seed: number) => void };\n    isAnimating: boolean;\n    isDragging: boolean;\n    dragStartX: number;\n    dragStartY: number;\n    currentDragX: number;\n    currentDragY: number;\n    dragDirection: string | null;\n    dragDistance: number;\n    previewOffset: { x: number; y: number };\n    minDragDistance: number;\n    dragThreshold: number;\n    dragStartTime: number;\n    quickSwipeThreshold: number;\n    quickSwipeEnabled: boolean;\n    lastTouchMoveTime: number;\n    touchMoveThrottle: number;\n    dragPreviewEnabled: boolean;\n    keydownHandler?: (e: KeyboardEvent) => void;\n    onGameEnd?: (score: number, won: boolean) => void;\n    onScoreUpdate?: (score: number, bestScore: number) => void;\n\n    constructor() {\n        this.size = 4;\n        this.grid = [];\n        this.score = 0;\n        this.bestScore = localStorage.getItem('bestScore') || 0;\n        \n        // 撤销系统\n        this.stateHistory = []; // 历史状态栈\n        this.maxHistorySize = 100; // 最多保存100个历史状态\n        this.initialUndoCount = 3; // 初始撤销次数\n        this.undoCount = this.initialUndoCount; // 当前可用撤销次数\n        this.maxUndoCount = 10; // 最大累计撤销次数\n        this.undoRewardValue = 256; // 每合成256的倍数获得撤销次数\n        \n        this.tileContainer = document.getElementById('tile-container');\n        this.scoreDisplay = document.getElementById('score');\n        this.bestScoreDisplay = document.getElementById('best-score');\n        this.messageContainer = document.getElementById('game-message');\n        \n        this.startX = 0;\n        this.startY = 0;\n        this.endX = 0;\n        this.endY = 0;\n        \n        this.tiles = {}; // 保存方块DOM元素的引用\n        this.tileId = 0; // 用于生成唯一的方块ID\n        \n        // 随机数生成器\n        this.randomSeed = Date.now(); // 初始种子\n        this.random = this.createSeededRandom(this.randomSeed);\n        \n        // 动画状态标志\n        this.isAnimating = false;\n        \n        // 拖动预览相关\n        this.isDragging = false;\n        this.dragStartX = 0;\n        this.dragStartY = 0;\n        this.currentDragX = 0;\n        this.currentDragY = 0;\n        this.dragDirection = null;\n        this.dragDistance = 0;\n        this.previewOffset = { x: 0, y: 0 };\n        this.minDragDistance = 30; // 触发移动的最小距离\n        this.dragThreshold = 3; // 开始显示拖动效果的阈值，降低以提高响应速度\n        \n        // 快速滑动检测\n        this.dragStartTime = 0;\n        this.quickSwipeThreshold = 300; // 增加到300ms，让更多滑动被识别为快速滑动\n        this.quickSwipeEnabled = true;\n        this.lastTouchMoveTime = 0;\n        this.touchMoveThrottle = 32; // 约30fps的节流，减少性能开销\n        \n        // 拖动预览开关（可以在低端设备上禁用）\n        this.dragPreviewEnabled = true;\n        // 检测是否是移动设备\n        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n        // 在旧设备上默认禁用拖动预览\n        if (isMobile && window.innerWidth <= 400) {\n            this.dragPreviewEnabled = true; // 保持开启，但可以根据需要改为false\n        }\n        \n        this.setup();\n        this.updateDisplay();\n        \n        // 防止页面滚动\n        this.preventPageScroll();\n        \n        // 修复iOS视口高度问题\n        this.fixViewportHeight();\n    }\n    \n    preventPageScroll() {\n        // 暂时注释掉，可能影响iOS全屏显示\n        // document.body.addEventListener('touchmove', (e) => {\n        //     e.preventDefault();\n        // }, { passive: false });\n    }\n    \n    fixViewportHeight() {\n        // 设置正确的视口高度，修复iOS上的问题\n        const setVH = () => {\n            const vh = window.innerHeight * 0.01;\n            document.documentElement.style.setProperty('--vh', `${vh}px`);\n        };\n        \n        // 初始设置\n        setVH();\n        \n        // 监听窗口大小变化\n        window.addEventListener('resize', setVH);\n        window.addEventListener('orientationchange', setVH);\n    }\n    \n    setup() {\n        // 初始化网格\n        for (let i = 0; i < this.size; i++) {\n            this.grid[i] = [];\n            for (let j = 0; j < this.size; j++) {\n                this.grid[i][j] = null;\n            }\n        }\n        \n        // 添加两个初始方块\n        this.addNewTile();\n        this.addNewTile();\n        \n        // 保存初始状态\n        this.saveState();\n        \n        // 设置事件监听器\n        this.setupEventListeners();\n        \n        // 更新最高分显示\n        this.bestScoreDisplay.textContent = this.bestScore;\n        \n        // 更新撤销按钮\n        this.updateUndoButton();\n        \n        // 启动液态玻璃动画\n        this.startLiquidAnimation();\n    }\n    \n    createSeededRandom(seed) {\n        // 创建基于种子的伪随机数生成器\n        let currentSeed = seed;\n        \n        return {\n            // 生成0到1之间的随机数\n            random: () => {\n                // 使用线性同余生成器（LCG）算法\n                currentSeed = (currentSeed * 1664525 + 1013904223) % 2147483647;\n                return currentSeed / 2147483647;\n            },\n            // 获取当前种子\n            getSeed: () => currentSeed,\n            // 设置新种子\n            setSeed: (newSeed) => {\n                currentSeed = newSeed;\n            }\n        };\n    }\n    \n    setupEventListeners() {\n        // 避免重复绑定，先存储事件处理器\n        if (!this.keydownHandler) {\n            this.keydownHandler = (e) => {\n                const keyMap = {\n                    37: 'left',  // Left arrow\n                    65: 'left',  // A\n                    38: 'up',    // Up arrow\n                    87: 'up',    // W\n                    39: 'right', // Right arrow\n                    68: 'right', // D\n                    40: 'down',  // Down arrow\n                    83: 'down'   // S\n                };\n                \n                const direction = keyMap[e.keyCode];\n                if (direction) {\n                    e.preventDefault();\n                    this.move(direction);\n                }\n\n                // 测试快捷键\n                if (e.keyCode === 57) { // \"9\" key\n                    e.preventDefault();\n                    this.showMessage('You Win!', 'game-won');\n                }\n                if (e.keyCode === 48) { // \"0\" key\n                    e.preventDefault();\n                    this.showMessage('Game Over', 'game-stuck');\n                }\n            };\n        }\n        \n        // 移除可能存在的旧监听器，然后添加新的\n        document.removeEventListener('keydown', this.keydownHandler);\n        document.addEventListener('keydown', this.keydownHandler);\n        \n        // 触摸事件 - 实现拖动预览效果\n        document.addEventListener('touchstart', (e) => {\n            // 排除按钮点击\n            if (e.target.closest('button')) return;\n            \n            // 如果还在动画中，不开始新的拖动\n            if (this.isAnimating) return;\n            \n            this.isDragging = true;\n            this.dragStartX = e.touches[0].clientX;\n            this.dragStartY = e.touches[0].clientY;\n            this.currentDragX = this.dragStartX;\n            this.currentDragY = this.dragStartY;\n            this.dragDirection = null;\n            this.dragDistance = 0;\n            this.dragStartTime = Date.now(); // 记录开始时间\n            \n            // 只在必要时重置砖块状态\n            // 检查是否有砖块还有残留的transform\n            const needsReset = Object.values(this.tiles).some(tile => {\n                const transform = tile.style.transform;\n                return transform && transform !== '' && transform !== 'translate(0, 0) scale(1) rotate(0deg)';\n            });\n            \n            if (needsReset) {\n                this.forceResetAllTiles();\n            }\n            \n            // 添加拖动状态类到游戏容器\n            this.tileContainer.classList.add('dragging-active');\n        }, { passive: true });\n        \n        document.addEventListener('touchmove', (e) => {\n            if (!this.isDragging || this.isAnimating) return;\n            \n            const currentTime = Date.now();\n            \n            // 节流处理，减少更新频率\n            if (currentTime - this.lastTouchMoveTime < this.touchMoveThrottle) {\n                return;\n            }\n            this.lastTouchMoveTime = currentTime;\n            \n            const currentX = e.touches[0].clientX;\n            const currentY = e.touches[0].clientY;\n            const diffX = currentX - this.dragStartX;\n            const diffY = currentY - this.dragStartY;\n            \n            this.currentDragX = currentX;\n            this.currentDragY = currentY;\n            \n            // 计算拖动方向和距离\n            const absDiffX = Math.abs(diffX);\n            const absDiffY = Math.abs(diffY);\n            \n            // 只有超过阈值才开始显示拖动效果\n            if (absDiffX > this.dragThreshold || absDiffY > this.dragThreshold) {\n                e.preventDefault(); // 防止页面滚动\n                \n                // 确定主要拖动方向\n                if (absDiffX > absDiffY) {\n                    this.dragDirection = diffX > 0 ? 'right' : 'left';\n                    this.dragDistance = absDiffX;\n                } else {\n                    this.dragDirection = diffY > 0 ? 'down' : 'up';\n                    this.dragDistance = absDiffY;\n                }\n                \n                // 检测是否是快速滑动\n                const dragDuration = currentTime - this.dragStartTime;\n                const isQuickSwipe = dragDuration < this.quickSwipeThreshold && this.dragDistance > this.minDragDistance;\n                \n                // 只有在慢速拖动且启用了拖动预览时才更新预览效果\n                if (!isQuickSwipe && this.quickSwipeEnabled && this.dragPreviewEnabled) {\n                    this.updateDragPreview(diffX, diffY);\n                }\n            }\n        }, { passive: false });\n        \n        document.addEventListener('touchend', (e) => {\n            if (!this.isDragging) return;\n            \n            this.isDragging = false;\n            \n            // 移除拖动状态类\n            this.tileContainer.classList.remove('dragging-active');\n            \n            // 计算滑动时长\n            const dragDuration = Date.now() - this.dragStartTime;\n            const isQuickSwipe = dragDuration < this.quickSwipeThreshold;\n            \n            // 对于快速滑动，降低移动阈值\n            const effectiveMinDistance = isQuickSwipe ? this.minDragDistance * 0.5 : this.minDragDistance;\n            \n            // 执行移动动画\n            if (this.dragDirection && this.dragDistance > effectiveMinDistance) {\n                if (isQuickSwipe && this.quickSwipeEnabled) {\n                    // 快速滑动：先立即重置所有transform，避免残留\n                    Object.values(this.tiles).forEach(tile => {\n                        tile.classList.remove('dragging');\n                        tile.style.transition = 'none';\n                        tile.style.transform = '';\n                    });\n                    // 强制重绘\n                    void this.tileContainer.offsetHeight;\n                    // 恢复transition后执行移动\n                    Object.values(this.tiles).forEach(tile => {\n                        tile.style.transition = '';\n                    });\n                    this.move(this.dragDirection);\n                } else {\n                    // 慢速拖动：从拖动预览状态平滑过渡到实际移动\n                    this.transitionFromDragToMove(this.dragDirection);\n                }\n            } else {\n                // 如果没有达到移动阈值\n                if (isQuickSwipe) {\n                    // 快速滑动但距离不够：立即重置，避免卡在中间\n                    this.forceResetAllTiles();\n                } else {\n                    // 慢速拖动：平滑恢复原位\n                    this.resetTileTransforms();\n                }\n            }\n        }, { passive: true });\n        \n        // 处理触摸取消事件\n        document.addEventListener('touchcancel', (e) => {\n            if (this.isDragging) {\n                this.isDragging = false;\n                this.tileContainer.classList.remove('dragging-active');\n                this.resetTileTransforms();\n            }\n        }, { passive: true });\n        \n        // 鼠标事件支持（桌面端）\n        let mouseDown = false;\n        \n        document.addEventListener('mousedown', (e) => {\n            if (e.target.closest('button')) return;\n            \n            // 如果还在动画中，不开始新的拖动\n            if (this.isAnimating) return;\n            \n            mouseDown = true;\n            this.isDragging = true;\n            this.dragStartX = e.clientX;\n            this.dragStartY = e.clientY;\n            this.currentDragX = this.dragStartX;\n            this.currentDragY = this.dragStartY;\n            this.dragDirection = null;\n            this.dragDistance = 0;\n            this.dragStartTime = Date.now(); // 记录开始时间\n            \n            // 确保所有砖块都在正确的位置\n            this.forceResetAllTiles();\n            this.tileContainer.classList.add('dragging-active');\n        });\n        \n        document.addEventListener('mousemove', (e) => {\n            if (!mouseDown || !this.isDragging || this.isAnimating) return;\n            \n            const diffX = e.clientX - this.dragStartX;\n            const diffY = e.clientY - this.dragStartY;\n            \n            this.currentDragX = e.clientX;\n            this.currentDragY = e.clientY;\n            \n            const absDiffX = Math.abs(diffX);\n            const absDiffY = Math.abs(diffY);\n            \n            if (absDiffX > this.dragThreshold || absDiffY > this.dragThreshold) {\n                if (absDiffX > absDiffY) {\n                    this.dragDirection = diffX > 0 ? 'right' : 'left';\n                    this.dragDistance = absDiffX;\n                } else {\n                    this.dragDirection = diffY > 0 ? 'down' : 'up';\n                    this.dragDistance = absDiffY;\n                }\n                \n                this.updateDragPreview(diffX, diffY);\n            }\n        });\n        \n        document.addEventListener('mouseup', (e) => {\n            if (!mouseDown) return;\n            \n            mouseDown = false;\n            this.isDragging = false;\n            this.tileContainer.classList.remove('dragging-active');\n            \n            // 检查是否是快速滑动（鼠标也支持快速滑动）\n            const dragDuration = Date.now() - this.dragStartTime;\n            const isQuickSwipe = dragDuration < this.quickSwipeThreshold;\n            \n            // 对于快速滑动，降低移动阈值\n            const effectiveMinDistance = isQuickSwipe ? this.minDragDistance * 0.5 : this.minDragDistance;\n            \n            if (this.dragDirection && this.dragDistance > effectiveMinDistance) {\n                if (isQuickSwipe && this.quickSwipeEnabled) {\n                    // 快速滑动：先立即重置所有transform，避免残留\n                    Object.values(this.tiles).forEach(tile => {\n                        tile.classList.remove('dragging');\n                        tile.style.transition = 'none';\n                        tile.style.transform = '';\n                    });\n                    // 强制重绘\n                    void this.tileContainer.offsetHeight;\n                    // 恢复transition后执行移动\n                    Object.values(this.tiles).forEach(tile => {\n                        tile.style.transition = '';\n                    });\n                    this.move(this.dragDirection);\n                } else {\n                    // 慢速拖动：从拖动预览状态平滑过渡到实际移动\n                    this.transitionFromDragToMove(this.dragDirection);\n                }\n            } else {\n                // 如果没有达到移动阈值\n                if (isQuickSwipe) {\n                    // 快速滑动但距离不够：立即重置，避免卡在中间\n                    this.forceResetAllTiles();\n                } else {\n                    // 慢速拖动：平滑恢复原位\n                    this.resetTileTransforms();\n                }\n            }\n        });\n    }\n    \n    handleSwipe() {\n        const diffX = this.endX - this.startX;\n        const diffY = this.endY - this.startY;\n        const minSwipeDistance = 30; // 降低最小滑动距离，让滑动更容易触发\n        \n        if (Math.abs(diffX) > Math.abs(diffY)) {\n            // 水平滑动\n            if (Math.abs(diffX) > minSwipeDistance) {\n                if (diffX > 0) {\n                    this.move('right');\n                } else {\n                    this.move('left');\n                }\n            }\n        } else {\n            // 垂直滑动\n            if (Math.abs(diffY) > minSwipeDistance) {\n                if (diffY > 0) {\n                    this.move('down');\n                } else {\n                    this.move('up');\n                }\n            }\n        }\n    }\n    \n    move(direction) {\n        // 如果正在动画中或正在拖动，忽略移动\n        if (this.isAnimating || this.isDragging) return;\n        \n        // 移除所有砖块的dragging类，确保使用正常的移动动画\n        Object.values(this.tiles).forEach(tile => {\n            tile.classList.remove('dragging');\n        });\n        \n        const movements = [];\n        const merges = [];\n        let moved = false;\n        \n        // 创建新的网格来存储结果\n        const newGrid = [];\n        for (let i = 0; i < this.size; i++) {\n            newGrid[i] = [];\n            for (let j = 0; j < this.size; j++) {\n                newGrid[i][j] = null;\n            }\n        }\n        \n        // 根据方向处理移动\n        if (direction === 'left') {\n            for (let row = 0; row < this.size; row++) {\n                const result = this.processLine(this.getRow(row), row, 0, 0, 1);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setRow(newGrid, row, result.line);\n            }\n        } else if (direction === 'right') {\n            for (let row = 0; row < this.size; row++) {\n                const result = this.processLine(this.getRow(row).reverse(), row, 3, 0, -1);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setRow(newGrid, row, result.line.reverse());\n            }\n        } else if (direction === 'up') {\n            for (let col = 0; col < this.size; col++) {\n                const result = this.processLine(this.getColumn(col), 0, col, 1, 0);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setColumn(newGrid, col, result.line);\n            }\n        } else if (direction === 'down') {\n            for (let col = 0; col < this.size; col++) {\n                const result = this.processLine(this.getColumn(col).reverse(), 3, col, -1, 0);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setColumn(newGrid, col, result.line.reverse());\n            }\n        }\n        \n        if (moved) {\n            // 设置动画标志\n            this.isAnimating = true;\n            \n            // 更新网格\n            this.grid = newGrid;\n            \n            // 执行动画\n            this.animateMovements(movements, merges, () => {\n                // 动画完成后添加新方块\n                this.addNewTile();\n                \n                // 修复：先保存状态，再更新显示\n                this.saveState();\n                this.updateDisplay();\n                \n                // 清除动画标志\n                this.isAnimating = false;\n                \n                // 游戏状态检查\n                if (this.checkWin()) {\n                    this.showMessage('You Win!', 'game-won');\n                } else if (this.checkGameOver()) {\n                    // 只有在没有撤销次数时才真正结束游戏\n                    if (this.undoCount === 0) {\n                        this.showMessage('Game Over', 'game-over');\n                        // 触发游戏结束回调\n                        if (this.onGameEnd) {\n                            this.onGameEnd(this.score, false);\n                        }\n                    } else {\n                        // 如果还有撤销次数，给用户提示\n                        this.showMessage('Game Over', 'game-stuck');\n                        // 也触发游戏结束回调提交分数\n                        if (this.onGameEnd) {\n                            this.onGameEnd(this.score, false);\n                        }\n                    }\n                }\n            });\n        }\n    }\n    \n    processLine(line, startRow, startCol, rowDir, colDir) {\n        const movements = [];\n        const merges = [];\n        const result = [];\n        let moved = false;\n        \n        // 第一步：移除空格，收集所有非空方块\n        const tiles = [];\n        for (let i = 0; i < line.length; i++) {\n            if (line[i] !== null) {\n                tiles.push({\n                    tile: line[i],\n                    originalIndex: i\n                });\n            }\n        }\n        \n        // 第二步：处理合并\n        let resultIndex = 0;\n        let i = 0;\n        \n        while (i < tiles.length) {\n            const currentTile = tiles[i];\n            const fromRow = startRow + currentTile.originalIndex * rowDir;\n            const fromCol = startCol + currentTile.originalIndex * colDir;\n            const toRow = startRow + resultIndex * rowDir;\n            const toCol = startCol + resultIndex * colDir;\n            \n            // 检查是否需要移动\n            if (fromRow !== toRow || fromCol !== toCol) {\n                movements.push({\n                    tile: currentTile.tile,\n                    from: { row: fromRow, col: fromCol },\n                    to: { row: toRow, col: toCol }\n                });\n                moved = true;\n            }\n            \n            // 检查是否可以合并\n            if (i + 1 < tiles.length && \n                currentTile.tile.value === tiles[i + 1].tile.value &&\n                !currentTile.tile.merged) {\n                \n                // 创建合并后的方块\n                const mergedTile = {\n                    id: this.tileId++,\n                    value: currentTile.tile.value * 2,\n                    merged: true\n                };\n                \n                // 记录第二个方块的移动（移动到合并位置）\n                const nextTile = tiles[i + 1];\n                const nextFromRow = startRow + nextTile.originalIndex * rowDir;\n                const nextFromCol = startCol + nextTile.originalIndex * colDir;\n                \n                movements.push({\n                    tile: nextTile.tile,\n                    from: { row: nextFromRow, col: nextFromCol },\n                    to: { row: toRow, col: toCol }\n                });\n                \n                // 记录合并\n                merges.push({\n                    tiles: [currentTile.tile, nextTile.tile],\n                    result: mergedTile,\n                    position: { row: toRow, col: toCol }\n                });\n                \n                result.push(mergedTile);\n                this.score += mergedTile.value;\n                moved = true;\n                \n                // 检查是否合成了256的倍数，奖励撤销次数\n                if (mergedTile.value >= this.undoRewardValue && \n                    mergedTile.value % this.undoRewardValue === 0) {\n                    this.earnUndoReward();\n                }\n                \n                i += 2; // 跳过已合并的两个方块\n            } else {\n                result.push(currentTile.tile);\n                i += 1;\n            }\n            \n            resultIndex++;\n        }\n        \n        // 第三步：填充空格\n        while (result.length < this.size) {\n            result.push(null);\n        }\n        \n        return { line: result, moved, movements, merges };\n    }\n    \n    getRow(row) {\n        return this.grid[row].slice();\n    }\n    \n    setRow(grid, row, values) {\n        grid[row] = values;\n    }\n    \n    getColumn(col) {\n        const column = [];\n        for (let i = 0; i < this.size; i++) {\n            column.push(this.grid[i][col]);\n        }\n        return column;\n    }\n    \n    setColumn(grid, col, values) {\n        for (let i = 0; i < this.size; i++) {\n            grid[i][col] = values[i];\n        }\n    }\n    \n    animateMovements(movements, merges, callback) {\n        // 先清除所有砖块的transform，确保从当前位置平滑过渡\n        Object.values(this.tiles).forEach(tile => {\n            if (tile.style.transform) {\n                // 保持原有的transition以确保平滑过渡\n                tile.style.transform = '';\n            }\n        });\n        \n        // 移动所有方块\n        movements.forEach(movement => {\n            const tile = this.tiles[movement.tile.id];\n            if (tile) {\n                const { top, left } = this.getPosition(movement.to.row, movement.to.col);\n                tile.style.top = top;\n                tile.style.left = left;\n            }\n        });\n        \n        // 120ms后处理合并（与CSS动画时间一致）\n        setTimeout(() => {\n            merges.forEach(merge => {\n                // 移除被合并的方块\n                merge.tiles.forEach(tile => {\n                    if (this.tiles[tile.id]) {\n                        this.tiles[tile.id].remove();\n                        delete this.tiles[tile.id];\n                    }\n                });\n                \n                // 创建新的合并后的方块\n                this.createTileElement(\n                    merge.position.row, \n                    merge.position.col, \n                    merge.result,\n                    false,\n                    true\n                );\n            });\n            \n            // 触发液态爆发效果\n            if (merges.length > 0) {\n                this.liquidBurst();\n            }\n            \n            // 更新分数显示\n            this.scoreDisplay.textContent = this.score;\n            if (this.score > this.bestScore) {\n                this.bestScore = this.score;\n                this.bestScoreDisplay.textContent = this.bestScore;\n                localStorage.setItem('bestScore', this.bestScore);\n            }\n            \n            // 再等待一小段时间后执行回调\n            setTimeout(callback, 30);\n        }, 120);\n    }\n    \n    addNewTile() {\n        const emptyCells = [];\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (this.grid[i][j] === null) {\n                    emptyCells.push({row: i, col: j});\n                }\n            }\n        }\n        \n        if (emptyCells.length > 0) {\n            const randomCell = emptyCells[Math.floor(this.random.random() * emptyCells.length)];\n            const value = this.random.random() < 0.9 ? 2 : 4;\n            const newTile = {\n                id: this.tileId++,\n                value: value,\n                merged: false\n            };\n            this.grid[randomCell.row][randomCell.col] = newTile;\n            this.createTileElement(randomCell.row, randomCell.col, newTile, true, false);\n        }\n    }\n    \n    updateDisplay() {\n        // 清理已标记为合并的方块\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (this.grid[i][j] && this.grid[i][j].merged) {\n                    this.grid[i][j].merged = false;\n                }\n            }\n        }\n        \n        // 更新分数显示\n        this.scoreDisplay.textContent = this.score;\n        \n        // 更新撤销按钮状态\n        this.updateUndoButton();\n    }\n    \n    earnUndoReward() {\n        if (this.undoCount < this.maxUndoCount) {\n            this.undoCount++;\n            this.showUndoReward();\n        }\n    }\n    \n    showUndoReward() {\n        // 创建一个临时的提示元素显示获得撤销次数\n        const reward = document.createElement('div');\n        reward.className = 'undo-reward';\n        reward.textContent = '+1 Undo';\n        document.querySelector('.score-container').appendChild(reward);\n        \n        // 1秒后移除提示\n        setTimeout(() => {\n            reward.remove();\n        }, 1000);\n    }\n    \n    updateUndoButton() {\n        const undoButton = document.querySelector('.btn-undo');\n        if (undoButton) {\n            // 更新按钮内部content层的文本显示剩余次数\n            const contentSpan = undoButton.querySelector('.liquidGlass-content');\n            if (contentSpan) {\n                contentSpan.textContent = `Undo (${this.undoCount})`;\n            }\n            \n            // 修复：当历史记录大于1时就应该启用撤销\n            if (this.undoCount > 0 && this.stateHistory.length > 1) {\n                undoButton.disabled = false;\n                undoButton.classList.remove('disabled');\n            } else {\n                undoButton.disabled = true;\n                undoButton.classList.add('disabled');\n            }\n        }\n    }\n    \n    createTileElement(row, col, tileData, isNew = false, isMerged = false, isReappear = false) {\n        const tileWrapper = document.createElement('div');\n        tileWrapper.className = `tile liquidGlass-wrapper tile-${tileData.value}`;\n        tileWrapper.id = `tile-${tileData.id}`;\n\n        if (isNew) {\n            tileWrapper.classList.add('tile-new');\n        }\n        if (isMerged) {\n            tileWrapper.classList.add('tile-merged');\n        }\n        if (isReappear) {\n            tileWrapper.classList.add('tile-reappear');\n        }\n\n        // 创建与示例代码一致的内部结构\n        const effectDiv = document.createElement('div');\n        effectDiv.className = 'liquidGlass-effect';\n\n        const tintDiv = document.createElement('div');\n        tintDiv.className = 'liquidGlass-tint';\n\n        const shineDiv = document.createElement('div');\n        shineDiv.className = 'liquidGlass-shine';\n\n        const textDiv = document.createElement('div');\n        textDiv.className = 'liquidGlass-text';\n        textDiv.textContent = tileData.value;\n\n        // 将内部结构添加到包装器中\n        tileWrapper.appendChild(effectDiv);\n        tileWrapper.appendChild(tintDiv);\n        tileWrapper.appendChild(shineDiv);\n        tileWrapper.appendChild(textDiv);\n        \n        const { top, left } = this.getPosition(row, col);\n        tileWrapper.style.top = top;\n        tileWrapper.style.left = left;\n        \n        this.tileContainer.appendChild(tileWrapper);\n        this.tiles[tileData.id] = tileWrapper; // 引用现在指向包装器\n    }\n    \n    getPosition(row, col) {\n        // 检查是否在小屏幕上（响应式）\n        const isSmallScreen = window.innerWidth <= 520;\n        const gap = isSmallScreen ? 8 : 10; // 响应式间隙\n        \n        // 计算每个格子的大小\n        const cellSize = `(100% - ${gap * 3}px) / 4`;\n        \n        // 计算位置：格子大小 * 索引 + 间隙 * 索引\n        const position = {\n            top: `calc(${cellSize} * ${row} + ${gap}px * ${row})`,\n            left: `calc(${cellSize} * ${col} + ${gap}px * ${col})`\n        };\n        \n        return position;\n    }\n    \n    checkWin() {\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (this.grid[i][j] && this.grid[i][j].value === 2048) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    \n    checkGameOver() {\n        // 检查是否还有空格\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (this.grid[i][j] === null) {\n                    return false;\n                }\n            }\n        }\n        \n        // 检查是否还能合并\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                const current = this.grid[i][j];\n                if (!current) continue;\n                \n                // 检查右边\n                if (j < this.size - 1 && this.grid[i][j + 1] && \n                    current.value === this.grid[i][j + 1].value) {\n                    return false;\n                }\n                // 检查下边\n                if (i < this.size - 1 && this.grid[i + 1][j] && \n                    current.value === this.grid[i + 1][j].value) {\n                    return false;\n                }\n            }\n        }\n        \n        return true;\n    }\n    \n    saveState() {\n        // 保存当前状态到历史栈\n        const state = {\n            grid: JSON.parse(JSON.stringify(this.grid)),\n            score: this.score,\n            undoCount: this.undoCount,\n            randomSeed: this.random.getSeed(), // 保存随机种子\n            tileId: this.tileId // 保存方块ID计数器\n        };\n        \n        // 检查是否与最后一个状态相同（避免重复保存）\n        if (this.stateHistory.length > 0) {\n            const lastState = this.stateHistory[this.stateHistory.length - 1];\n            // 比较分数作为简单的重复检查（如果分数相同，很可能是重复状态）\n            if (lastState.score === state.score && lastState.tileId === state.tileId) {\n                return;\n            }\n        }\n        \n        this.stateHistory.push(state);\n        \n        // 限制历史栈大小\n        if (this.stateHistory.length > this.maxHistorySize) {\n            this.stateHistory.shift();\n        }\n    }\n    \n    undo() {\n        // 如果正在动画中，忽略撤销\n        if (this.isAnimating) return;\n        \n        // 检查是否有撤销次数和历史记录\n        if (this.undoCount > 0 && this.stateHistory.length > 1) {\n            // 设置动画标志\n            this.isAnimating = true;\n            \n            // 保存当前游戏状态的快照，用于计算动画\n            const currentGridSnapshot = JSON.parse(JSON.stringify(this.grid));\n            \n            // 移除历史栈最后一个状态（当前状态）\n            this.stateHistory.pop();\n            \n            // 获取要恢复到的状态（上一个状态）\n            const previousState = this.stateHistory[this.stateHistory.length - 1];\n            \n            // 使用快照的grid计算动画，而不是this.grid\n            const animations = this.calculateUndoAnimations(currentGridSnapshot, previousState.grid);\n            \n            // 执行撤销动画\n            this.animateUndo(animations, () => {\n                // 动画完成后，更新游戏状态\n                this.grid = JSON.parse(JSON.stringify(previousState.grid));\n                this.score = previousState.score;\n                \n                // 恢复随机种子和方块ID\n                this.random.setSeed(previousState.randomSeed);\n                this.tileId = previousState.tileId;\n                \n                // 减少撤销次数\n                this.undoCount--;\n                \n                // 更新显示\n                this.updateDisplay();\n                this.updateUndoButton();\n                \n                // 清除动画标志\n                this.isAnimating = false;\n            });\n        }\n    }\n    \n    calculateUndoAnimations(currentGrid, previousGrid) {\n        const animations = {\n            movements: [],      // 方块移动\n            disappears: [],     // 方块消失（合并后的方块）\n            appears: []         // 方块出现（分裂回原来的方块）\n        };\n        \n        // 创建一个映射来追踪方块\n        const currentTiles = new Map();\n        const previousTiles = new Map();\n        \n        // 收集当前状态的所有方块\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (currentGrid[i][j]) {\n                    currentTiles.set(currentGrid[i][j].id, {\n                        tile: currentGrid[i][j],\n                        row: i,\n                        col: j\n                    });\n                }\n            }\n        }\n        \n        // 收集之前状态的所有方块\n        for (let i = 0; i < this.size; i++) {\n            for (let j = 0; j < this.size; j++) {\n                if (previousGrid[i][j]) {\n                    previousTiles.set(previousGrid[i][j].id, {\n                        tile: previousGrid[i][j],\n                        row: i,\n                        col: j\n                    });\n                }\n            }\n        }\n        \n        // 查找需要移动的方块\n        previousTiles.forEach((prevInfo, id) => {\n            const currInfo = currentTiles.get(id);\n            if (currInfo) {\n                // 方块在两个状态都存在，检查是否需要移动\n                if (currInfo.row !== prevInfo.row || currInfo.col !== prevInfo.col) {\n                    animations.movements.push({\n                        tile: prevInfo.tile,\n                        from: { row: currInfo.row, col: currInfo.col },\n                        to: { row: prevInfo.row, col: prevInfo.col }\n                    });\n                }\n            } else {\n                // 方块在当前状态不存在，需要重新出现（被合并的方块）\n                animations.appears.push({\n                    tile: prevInfo.tile,\n                    position: { row: prevInfo.row, col: prevInfo.col }\n                });\n            }\n        });\n        \n        // 查找需要消失的方块（当前有但之前没有的，如新生成的方块或合并产生的方块）\n        currentTiles.forEach((currInfo, id) => {\n            if (!previousTiles.has(id)) {\n                animations.disappears.push({\n                    tile: currInfo.tile,\n                    position: { row: currInfo.row, col: currInfo.col }\n                });\n            }\n        });\n        \n        return animations;\n    }\n    \n    animateUndo(animations, callback) {\n        // 首先，让需要消失的方块消失（反向的新方块出现动画）\n        animations.disappears.forEach(item => {\n            const tile = this.tiles[item.tile.id];\n            if (tile) {\n                tile.classList.add('tile-disappear');\n            }\n        });\n        \n        // 同时移动需要移动的方块\n        animations.movements.forEach(movement => {\n            const tile = this.tiles[movement.tile.id];\n            if (tile) {\n                const { top, left } = this.getPosition(movement.to.row, movement.to.col);\n                tile.style.top = top;\n                tile.style.left = left;\n            }\n        });\n        \n        // 150ms后，处理方块的出现和最终状态\n        setTimeout(() => {\n            // 移除消失的方块\n            animations.disappears.forEach(item => {\n                const tile = this.tiles[item.tile.id];\n                if (tile) {\n                    tile.remove();\n                    delete this.tiles[item.tile.id];\n                }\n            });\n            \n            // 清空所有现有方块并重建（确保状态一致）\n            this.tileContainer.innerHTML = '';\n            this.tiles = {};\n            \n            // 从previousGrid重建所有方块\n            const previousState = this.stateHistory[this.stateHistory.length - 1];\n            for (let i = 0; i < this.size; i++) {\n                for (let j = 0; j < this.size; j++) {\n                    if (previousState.grid[i][j]) {\n                        const wasNewlyAppeared = animations.appears.some(\n                            item => item.tile.id === previousState.grid[i][j].id\n                        );\n                        this.createTileElement(i, j, previousState.grid[i][j], false, false, wasNewlyAppeared);\n                    }\n                }\n            }\n            \n            // 执行回调\n            setTimeout(callback, 50);\n        }, 150);\n    }\n    \n    restart() {\n        // 清空方块\n        this.tileContainer.innerHTML = '';\n        this.tiles = {};\n        \n        this.grid = [];\n        this.score = 0;\n        this.stateHistory = [];\n        this.undoCount = this.initialUndoCount;\n        this.tileId = 0;\n        \n        // 重置随机数生成器\n        this.randomSeed = Date.now();\n        this.random = this.createSeededRandom(this.randomSeed);\n        \n        this.hideMessage();\n        this.setup();\n    }\n    \n    showMessage(text, className) {\n        this.messageContainer.innerHTML = ''; // 先清空内容\n        \n        const messageText = document.createElement('p');\n        messageText.textContent = text;\n        this.messageContainer.appendChild(messageText);\n\n        this.messageContainer.className = 'game-message ' + className;\n        \n        // 当游戏卡住时，显示\"撤销\"和\"再来一局\"两个按钮\n        if (className === 'game-stuck') {\n            const buttonContainer = document.createElement('div');\n            buttonContainer.className = 'message-buttons';\n            \n            const undoButton = document.createElement('button');\n            undoButton.className = 'restart-button';\n            undoButton.textContent = `Undo (${this.undoCount})`;\n            undoButton.onclick = () => {\n                this.hideMessage();\n                this.undo();\n            };\n            \n            const restartButton = document.createElement('button');\n            restartButton.className = 'restart-button';\n            restartButton.textContent = 'Try Again';\n            restartButton.onclick = () => game.restart();\n            \n            buttonContainer.appendChild(undoButton);\n            buttonContainer.appendChild(restartButton);\n            this.messageContainer.appendChild(buttonContainer);\n\n        } else if (className !== 'game-won' && className !== 'game-over') {\n            const restartButton = document.createElement('button');\n            restartButton.className = 'restart-button';\n            restartButton.textContent = 'Try Again';\n            restartButton.onclick = () => game.restart();\n            this.messageContainer.appendChild(restartButton);\n        } else {\n             const restartButton = document.createElement('button');\n            restartButton.className = 'restart-button';\n            restartButton.textContent = 'Try Again';\n            restartButton.onclick = () => game.restart();\n            this.messageContainer.appendChild(restartButton);\n        }\n\n        this.messageContainer.style.display = 'flex';\n        this.messageContainer.style.alignItems = 'center';\n        this.messageContainer.style.justifyContent = 'center';\n        this.messageContainer.style.flexDirection = 'column';\n    }\n    \n    hideMessage() {\n        this.messageContainer.style.display = 'none';\n        this.messageContainer.className = 'game-message';\n    }\n    \n    startLiquidAnimation() {\n        // 移除液态动画，因为新的实现不需要动态修改滤镜参数\n        // 液态效果现在是静态的，只在背景层显示\n    }\n    \n    // 液态爆发效果 - 用于合并动画\n    liquidBurst() {\n        const displacementMap = document.querySelector('#liquid-burst feDisplacementMap');\n        if (!displacementMap) return;\n        \n        // 临时增加扭曲强度\n        const originalScale = displacementMap.getAttribute('scale');\n        displacementMap.setAttribute('scale', '60');\n        \n        // 300ms后恢复\n        setTimeout(() => {\n            displacementMap.setAttribute('scale', originalScale);\n        }, 300);\n    }\n    \n    // 更新拖动预览效果\n    updateDragPreview(offsetX, offsetY) {\n        // 计算单个格子的大小\n        const cellSize = this.tileContainer.offsetWidth / 4;\n        const gap = 10; // 格子间距\n        const unitDistance = cellSize + gap;\n        \n        // 计算预览偏移量，使用缓动系数让动画更流畅\n        const dampingFactor = 0.7; // 提高缓动系数，让跟随更灵敏\n        const maxOffset = unitDistance * 3.5; // 最大可以移动3.5个格子的距离\n        \n        // 根据拖动方向限制偏移\n        let basePreviewX = 0;\n        let basePreviewY = 0;\n        \n        if (this.dragDirection === 'left' || this.dragDirection === 'right') {\n            basePreviewX = Math.max(-maxOffset, Math.min(maxOffset, offsetX * dampingFactor));\n            basePreviewY = 0;\n        } else if (this.dragDirection === 'up' || this.dragDirection === 'down') {\n            basePreviewX = 0;\n            basePreviewY = Math.max(-maxOffset, Math.min(maxOffset, offsetY * dampingFactor));\n        }\n        \n        // 批量更新所有砖块的transform\n        const transforms = [];\n        \n        // 应用transform到所有可移动的砖块\n        for (let row = 0; row < this.size; row++) {\n            for (let col = 0; col < this.size; col++) {\n                const tile = this.grid[row][col];\n                if (tile && this.tiles[tile.id]) {\n                    const element = this.tiles[tile.id];\n                    \n                    // 检查这个砖块在当前方向上是否可以移动\n                    if (this.canTileMove(row, col, this.dragDirection)) {\n                        // 添加dragging类\n                        if (!element.classList.contains('dragging')) {\n                            element.classList.add('dragging');\n                        }\n                        \n                        // 计算渐进的偏移量\n                        // 使用更线性的进度计算，避免初始阶段过度缩减\n                        const linearProgress = Math.min(this.dragDistance / this.minDragDistance, 1);\n                        // 在初始阶段使用更线性的响应，后期才加入缓动\n                        const progress = linearProgress < 0.5 \n                            ? linearProgress * 1.5  // 初始阶段放大响应\n                            : this.easeOutCubic(linearProgress);\n                        \n                        // 计算每个砖块可以移动的最大距离\n                        let maxMoveDistance = 0;\n                        \n                        if (this.dragDirection === 'left') {\n                            maxMoveDistance = col * unitDistance;\n                        } else if (this.dragDirection === 'right') {\n                            maxMoveDistance = (this.size - 1 - col) * unitDistance;\n                        } else if (this.dragDirection === 'up') {\n                            maxMoveDistance = row * unitDistance;\n                        } else if (this.dragDirection === 'down') {\n                            maxMoveDistance = (this.size - 1 - row) * unitDistance;\n                        }\n                        \n                        // 计算实际偏移量，但不超过砖块可以移动的最大距离\n                        const targetOffset = this.dragDirection === 'left' || this.dragDirection === 'right' \n                            ? basePreviewX : basePreviewY;\n                        // 直接使用progress而不是easedProgress，因为已经在上面处理了\n                        const actualOffset = Math.sign(targetOffset) * \n                            Math.min(Math.abs(targetOffset * progress), maxMoveDistance * 0.9);\n                        \n                        const actualX = this.dragDirection === 'left' || this.dragDirection === 'right' \n                            ? actualOffset : 0;\n                        const actualY = this.dragDirection === 'up' || this.dragDirection === 'down' \n                            ? actualOffset : 0;\n                        \n                        // 添加轻微的缩放和倾斜效果\n                        // 只在拖动距离较大时才添加缩放和旋转，避免初始阶段的突变\n                        const visualProgress = Math.max(0, (linearProgress - 0.2) / 0.8);\n                        const scale = 1 + (visualProgress * 0.02);\n                        const rotate = this.dragDirection === 'left' ? -1 : \n                                     this.dragDirection === 'right' ? 1 : \n                                     this.dragDirection === 'up' ? -0.5 : 0.5;\n                        const rotateAngle = rotate * visualProgress * 2;\n                        \n                        // 直接设置transform，不使用requestAnimationFrame\n                        element.style.transform = `translate(${actualX}px, ${actualY}px) scale(${scale}) rotate(${rotateAngle}deg)`;\n                    } else {\n                        element.classList.remove('dragging');\n                        // 边缘的砖块保持原位\n                        element.style.transform = 'translate(0, 0) scale(1) rotate(0deg)';\n                    }\n                }\n            }\n        }\n    }\n    \n    // 缓动函数\n    easeOutCubic(t) {\n        return 1 - Math.pow(1 - t, 3);\n    }\n    \n    // 重置所有砖块的transform\n    resetTileTransforms() {\n        Object.values(this.tiles).forEach(tile => {\n            tile.classList.remove('dragging');\n            tile.classList.remove('moving');\n            tile.style.transition = 'transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)';\n            tile.style.transform = 'translate(0, 0) scale(1) rotate(0deg)';\n        });\n    }\n    \n    // 强制重置所有砖块到正确位置（更彻底的重置）\n    forceResetAllTiles() {\n        // 遍历网格，确保每个砖块都在正确的位置\n        for (let row = 0; row < this.size; row++) {\n            for (let col = 0; col < this.size; col++) {\n                const gridTile = this.grid[row][col];\n                if (gridTile && this.tiles[gridTile.id]) {\n                    const tile = this.tiles[gridTile.id];\n                    const { top, left } = this.getPosition(row, col);\n                    \n                    // 移除所有类\n                    tile.classList.remove('dragging', 'moving');\n                    \n                    // 重置样式\n                    tile.style.transition = 'none';\n                    tile.style.transform = 'translate(0, 0) scale(1) rotate(0deg)';\n                    tile.style.top = top;\n                    tile.style.left = left;\n                    \n                    // 强制重绘\n                    void tile.offsetHeight;\n                    \n                    // 恢复transition\n                    tile.style.transition = '';\n                }\n            }\n        }\n        \n        // 移除任何不在网格中的孤立砖块\n        Object.keys(this.tiles).forEach(id => {\n            let found = false;\n            for (let row = 0; row < this.size && !found; row++) {\n                for (let col = 0; col < this.size && !found; col++) {\n                    if (this.grid[row][col] && this.grid[row][col].id === parseInt(id)) {\n                        found = true;\n                    }\n                }\n            }\n            if (!found && this.tiles[id]) {\n                this.tiles[id].remove();\n                delete this.tiles[id];\n            }\n        });\n    }\n    \n    // 动画滑动到目标位置\n    animateTilesToTarget(direction, callback) {\n        // 立即设置动画标志，防止重复触发\n        this.isAnimating = true;\n        \n        const movements = [];\n        const merges = [];\n        \n        // 预计算所有砖块的移动路径\n        for (let row = 0; row < this.size; row++) {\n            for (let col = 0; col < this.size; col++) {\n                const tile = this.grid[row][col];\n                if (tile && this.tiles[tile.id] && this.canTileMove(row, col, direction)) {\n                    const element = this.tiles[tile.id];\n                    const movement = this.calculateMovement(row, col, direction);\n                    \n                    if (movement) {\n                        movements.push({\n                            element: element,\n                            from: { row, col },\n                            to: movement.to,\n                            distance: movement.distance,\n                            willMerge: movement.willMerge\n                        });\n                    }\n                }\n            }\n        }\n        \n        // 执行流畅的移动动画\n        const cellSize = this.tileContainer.offsetWidth / 4;\n        const gap = 10;\n        const unitDistance = cellSize + gap;\n        \n        movements.forEach(move => {\n            const element = move.element;\n            const distance = move.distance * unitDistance;\n            \n            let translateX = 0;\n            let translateY = 0;\n            \n            switch (direction) {\n                case 'left':\n                    translateX = -distance;\n                    break;\n                case 'right':\n                    translateX = distance;\n                    break;\n                case 'up':\n                    translateY = -distance;\n                    break;\n                case 'down':\n                    translateY = distance;\n                    break;\n            }\n            \n            // 移除dragging类，使用快速过渡\n            element.classList.remove('dragging');\n            element.style.transition = 'transform 0.12s cubic-bezier(0.25, 0.46, 0.45, 0.94)';\n            element.style.transform = `translate(${translateX}px, ${translateY}px)`;\n            \n            // 如果会合并，添加轻微的缩放效果\n            if (move.willMerge) {\n                element.style.transform += ' scale(0.95)';\n            }\n        });\n        \n        // 在动画完成后执行回调\n        setTimeout(() => {\n            // 重置所有transform\n            this.resetTileTransforms();\n            \n            // 清除动画标志\n            this.isAnimating = false;\n            \n            // 执行真正的移动逻辑\n            if (callback) {\n                callback();\n            }\n        }, 120);\n    }\n    \n    // 计算砖块的移动信息\n    calculateMovement(row, col, direction) {\n        const tile = this.grid[row][col];\n        if (!tile) return null;\n        \n        let targetRow = row;\n        let targetCol = col;\n        let distance = 0;\n        let willMerge = false;\n        \n        // 根据方向计算目标位置\n        if (direction === 'left') {\n            for (let c = col - 1; c >= 0; c--) {\n                if (this.grid[row][c] === null) {\n                    targetCol = c;\n                    distance++;\n                } else if (this.grid[row][c].value === tile.value && !this.grid[row][c].merged) {\n                    targetCol = c;\n                    distance++;\n                    willMerge = true;\n                    break;\n                } else {\n                    break;\n                }\n            }\n        } else if (direction === 'right') {\n            for (let c = col + 1; c < this.size; c++) {\n                if (this.grid[row][c] === null) {\n                    targetCol = c;\n                    distance++;\n                } else if (this.grid[row][c].value === tile.value && !this.grid[row][c].merged) {\n                    targetCol = c;\n                    distance++;\n                    willMerge = true;\n                    break;\n                } else {\n                    break;\n                }\n            }\n        } else if (direction === 'up') {\n            for (let r = row - 1; r >= 0; r--) {\n                if (this.grid[r][col] === null) {\n                    targetRow = r;\n                    distance++;\n                } else if (this.grid[r][col].value === tile.value && !this.grid[r][col].merged) {\n                    targetRow = r;\n                    distance++;\n                    willMerge = true;\n                    break;\n                } else {\n                    break;\n                }\n            }\n        } else if (direction === 'down') {\n            for (let r = row + 1; r < this.size; r++) {\n                if (this.grid[r][col] === null) {\n                    targetRow = r;\n                    distance++;\n                } else if (this.grid[r][col].value === tile.value && !this.grid[r][col].merged) {\n                    targetRow = r;\n                    distance++;\n                    willMerge = true;\n                    break;\n                } else {\n                    break;\n                }\n            }\n        }\n        \n        if (distance > 0) {\n            return {\n                to: { row: targetRow, col: targetCol },\n                distance: distance,\n                willMerge: willMerge\n            };\n        }\n        \n        return null;\n    }\n    \n    // 检查砖块在指定方向上是否可以移动\n    canTileMove(row, col, direction) {\n        const tile = this.grid[row][col];\n        if (!tile) return false;\n        \n        // 更简单的逻辑：只要不在移动方向的边缘，就认为可以移动\n        // 这样所有理论上可以移动的砖块都会参与拖动预览\n        switch (direction) {\n            case 'left':\n                return col > 0;\n            case 'right':\n                return col < this.size - 1;\n            case 'up':\n                return row > 0;\n            case 'down':\n                return row < this.size - 1;\n            default:\n                return false;\n        }\n    }\n    \n    // 从拖动预览状态过渡到实际移动\n    transitionFromDragToMove(direction) {\n        // 设置动画标志\n        this.isAnimating = true;\n        \n        // 先确保所有砖块都没有dragging类\n        Object.values(this.tiles).forEach(tile => {\n            tile.classList.remove('dragging');\n        });\n        \n        // 保存当前所有砖块的transform状态\n        const currentTransforms = {};\n        Object.keys(this.tiles).forEach(id => {\n            const element = this.tiles[id];\n            const transform = window.getComputedStyle(element).transform;\n            currentTransforms[id] = transform;\n        });\n        \n        // 立即执行游戏逻辑，但暂时不更新显示\n        const movements = [];\n        const merges = [];\n        let moved = false;\n        \n        // 创建新的网格来存储结果\n        const newGrid = [];\n        for (let i = 0; i < this.size; i++) {\n            newGrid[i] = [];\n            for (let j = 0; j < this.size; j++) {\n                newGrid[i][j] = null;\n            }\n        }\n        \n        // 根据方向处理移动逻辑（复用原有逻辑）\n        if (direction === 'left') {\n            for (let row = 0; row < this.size; row++) {\n                const result = this.processLine(this.getRow(row), row, 0, 0, 1);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setRow(newGrid, row, result.line);\n            }\n        } else if (direction === 'right') {\n            for (let row = 0; row < this.size; row++) {\n                const result = this.processLine(this.getRow(row).reverse(), row, 3, 0, -1);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setRow(newGrid, row, result.line.reverse());\n            }\n        } else if (direction === 'up') {\n            for (let col = 0; col < this.size; col++) {\n                const result = this.processLine(this.getColumn(col), 0, col, 1, 0);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setColumn(newGrid, col, result.line);\n            }\n        } else if (direction === 'down') {\n            for (let col = 0; col < this.size; col++) {\n                const result = this.processLine(this.getColumn(col).reverse(), 3, col, -1, 0);\n                moved = result.moved || moved;\n                movements.push(...result.movements);\n                merges.push(...result.merges);\n                this.setColumn(newGrid, col, result.line.reverse());\n            }\n        }\n        \n        if (moved) {\n            // 更新网格\n            this.grid = newGrid;\n            \n            // 从当前transform状态平滑过渡到最终位置\n            this.animateFromCurrentPosition(movements, merges, () => {\n                // 动画完成后添加新方块\n                this.addNewTile();\n                this.saveState();\n                this.updateDisplay();\n                this.isAnimating = false;\n                \n                // 游戏状态检查\n                if (this.checkWin()) {\n                    this.showMessage('你赢了!', 'game-won');\n                } else if (this.checkGameOver()) {\n                    if (this.undoCount === 0) {\n                        this.showMessage('游戏结束', 'game-over');\n                    } else {\n                        this.showMessage('无路可走!', 'game-stuck');\n                    }\n                }\n            });\n        } else {\n            // 如果没有移动，确保重置所有砖块的transform\n            this.resetTileTransforms();\n            // 短暂延迟后清除动画标志，确保重置动画完成\n            setTimeout(() => {\n                this.isAnimating = false;\n            }, 200);\n        }\n    }\n    \n    // 从当前位置动画到最终位置\n    animateFromCurrentPosition(movements, merges, callback) {\n        // 先移除所有砖块的dragging类，添加moving类\n        Object.values(this.tiles).forEach(tile => {\n            tile.classList.remove('dragging');\n            tile.classList.add('moving');\n        });\n        \n        // 计算每个砖块需要移动的距离并应用transform\n        const cellSize = this.tileContainer.offsetWidth / 4;\n        const gap = 10;\n        const unitDistance = cellSize + gap;\n        \n        // 记录所有需要移动的砖块ID\n        const movingTileIds = new Set();\n        \n        movements.forEach(movement => {\n            const tile = this.tiles[movement.tile.id];\n            if (tile) {\n                movingTileIds.add(movement.tile.id);\n                // 计算从原始位置到目标位置的偏移\n                const deltaRow = movement.to.row - movement.from.row;\n                const deltaCol = movement.to.col - movement.from.col;\n                const targetX = deltaCol * unitDistance;\n                const targetY = deltaRow * unitDistance;\n                \n                // 直接设置最终的transform\n                tile.style.transform = `translate(${targetX}px, ${targetY}px)`;\n            }\n        });\n        \n        // 重置所有未移动的砖块的transform\n        Object.entries(this.tiles).forEach(([id, tile]) => {\n            if (!movingTileIds.has(id)) {\n                tile.style.transform = 'translate(0, 0) scale(1) rotate(0deg)';\n                tile.classList.remove('moving');\n            }\n        });\n        \n        // 120ms后处理合并和位置更新（与正常动画时间一致）\n        setTimeout(() => {\n            // 更新所有移动砖块的实际位置\n            movements.forEach(movement => {\n                const tile = this.tiles[movement.tile.id];\n                if (tile) {\n                    const { top, left } = this.getPosition(movement.to.row, movement.to.col);\n                    // 移除transition临时\n                    tile.style.transition = 'none';\n                    // 重置transform并设置新位置\n                    tile.style.transform = 'translate(0, 0) scale(1) rotate(0deg)';\n                    tile.style.top = top;\n                    tile.style.left = left;\n                    // 强制重绘\n                    void tile.offsetHeight;\n                    // 恢复transition并移除moving类\n                    tile.style.transition = '';\n                    tile.classList.remove('moving');\n                }\n            });\n            \n            // 处理合并\n            merges.forEach(merge => {\n                // 移除被合并的方块\n                merge.tiles.forEach(tile => {\n                    if (this.tiles[tile.id]) {\n                        this.tiles[tile.id].remove();\n                        delete this.tiles[tile.id];\n                    }\n                });\n                \n                // 创建新的合并后的方块\n                this.createTileElement(\n                    merge.position.row, \n                    merge.position.col, \n                    merge.result,\n                    false,\n                    true\n                );\n            });\n            \n            // 触发液态爆发效果\n            if (merges.length > 0) {\n                this.liquidBurst();\n            }\n            \n            // 更新分数显示\n            this.scoreDisplay.textContent = this.score;\n            if (this.score > this.bestScore) {\n                this.bestScore = this.score;\n                this.bestScoreDisplay.textContent = this.bestScore;\n                localStorage.setItem('bestScore', this.bestScore);\n            }\n            \n            // 确保所有砖块的transform都被重置\n            setTimeout(() => {\n                // 强制重置所有砖块到正确位置\n                this.forceResetAllTiles();\n                callback();\n            }, 30);\n        }, 120);\n    }\n}\n\n// 导出类供 React 使用\nexport { Game2048 }; "],"names":[],"mappings":"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"}