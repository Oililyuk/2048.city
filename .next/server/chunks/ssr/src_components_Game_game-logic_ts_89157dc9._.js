module.exports=[77934,a=>{"use strict";class b{size;grid;score;bestScore;stateHistory;maxHistorySize;initialUndoCount;undoCount;maxUndoCount;undoRewardValue;tileContainer;scoreDisplay;bestScoreDisplay;messageContainer;startX;startY;endX;endY;tiles;tileId;randomSeed;random;isAnimating;isDragging;dragStartX;dragStartY;currentDragX;currentDragY;dragDirection;dragDistance;previewOffset;minDragDistance;dragThreshold;dragStartTime;quickSwipeThreshold;quickSwipeEnabled;lastTouchMoveTime;touchMoveThrottle;dragPreviewEnabled;keydownHandler;onGameEnd;onScoreUpdate;constructor(){this.size=4,this.grid=[],this.score=0,this.bestScore=localStorage.getItem("bestScore")||0,this.stateHistory=[],this.maxHistorySize=100,this.initialUndoCount=3,this.undoCount=this.initialUndoCount,this.maxUndoCount=10,this.undoRewardValue=256,this.tileContainer=document.getElementById("tile-container"),this.scoreDisplay=document.getElementById("score"),this.bestScoreDisplay=document.getElementById("best-score"),this.messageContainer=document.getElementById("game-message"),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.tiles={},this.tileId=0,this.randomSeed=Date.now(),this.random=this.createSeededRandom(this.randomSeed),this.isAnimating=!1,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.currentDragX=0,this.currentDragY=0,this.dragDirection=null,this.dragDistance=0,this.previewOffset={x:0,y:0},this.minDragDistance=30,this.dragThreshold=3,this.dragStartTime=0,this.quickSwipeThreshold=300,this.quickSwipeEnabled=!0,this.lastTouchMoveTime=0,this.touchMoveThrottle=32,this.dragPreviewEnabled=!0,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&window.innerWidth<=400&&(this.dragPreviewEnabled=!0),this.setup(),this.updateDisplay(),this.preventPageScroll(),this.fixViewportHeight()}preventPageScroll(){}fixViewportHeight(){let a=()=>{let a=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${a}px`)};a(),window.addEventListener("resize",a),window.addEventListener("orientationchange",a)}setup(){for(let a=0;a<this.size;a++){this.grid[a]=[];for(let b=0;b<this.size;b++)this.grid[a][b]=null}this.addNewTile(),this.addNewTile(),this.saveState(),this.setupEventListeners(),this.bestScoreDisplay.textContent=this.bestScore,this.updateUndoButton(),this.startLiquidAnimation()}createSeededRandom(a){let b=a;return{random:()=>(b=(1664525*b+0x3c6ef35f)%0x7fffffff)/0x7fffffff,getSeed:()=>b,setSeed:a=>{b=a}}}setupEventListeners(){this.keydownHandler||(this.keydownHandler=a=>{let b={37:"left",65:"left",38:"up",87:"up",39:"right",68:"right",40:"down",83:"down"}[a.keyCode];b&&(a.preventDefault(),this.move(b)),57===a.keyCode&&(a.preventDefault(),this.showMessage("You Win!","game-won")),48===a.keyCode&&(a.preventDefault(),this.showMessage("Game Over","game-stuck"))}),document.removeEventListener("keydown",this.keydownHandler),document.addEventListener("keydown",this.keydownHandler),document.addEventListener("touchstart",a=>{a.target.closest("button")||this.isAnimating||(this.isDragging=!0,this.dragStartX=a.touches[0].clientX,this.dragStartY=a.touches[0].clientY,this.currentDragX=this.dragStartX,this.currentDragY=this.dragStartY,this.dragDirection=null,this.dragDistance=0,this.dragStartTime=Date.now(),Object.values(this.tiles).some(a=>{let b=a.style.transform;return b&&""!==b&&"translate(0, 0) scale(1) rotate(0deg)"!==b})&&this.forceResetAllTiles(),this.tileContainer.classList.add("dragging-active"))},{passive:!0}),document.addEventListener("touchmove",a=>{if(!this.isDragging||this.isAnimating)return;let b=Date.now();if(b-this.lastTouchMoveTime<this.touchMoveThrottle)return;this.lastTouchMoveTime=b;let c=a.touches[0].clientX,d=a.touches[0].clientY,e=c-this.dragStartX,f=d-this.dragStartY;this.currentDragX=c,this.currentDragY=d;let g=Math.abs(e),h=Math.abs(f);(g>this.dragThreshold||h>this.dragThreshold)&&(a.preventDefault(),g>h?(this.dragDirection=e>0?"right":"left",this.dragDistance=g):(this.dragDirection=f>0?"down":"up",this.dragDistance=h),!(b-this.dragStartTime<this.quickSwipeThreshold&&this.dragDistance>this.minDragDistance)&&this.quickSwipeEnabled&&this.dragPreviewEnabled&&this.updateDragPreview(e,f))},{passive:!1}),document.addEventListener("touchend",a=>{if(!this.isDragging)return;this.isDragging=!1,this.tileContainer.classList.remove("dragging-active");let b=Date.now()-this.dragStartTime<this.quickSwipeThreshold,c=b?.5*this.minDragDistance:this.minDragDistance;this.dragDirection&&this.dragDistance>c?b&&this.quickSwipeEnabled?(Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging"),a.style.transition="none",a.style.transform=""}),this.tileContainer.offsetHeight,Object.values(this.tiles).forEach(a=>{a.style.transition=""}),this.move(this.dragDirection)):this.transitionFromDragToMove(this.dragDirection):b?this.forceResetAllTiles():this.resetTileTransforms()},{passive:!0}),document.addEventListener("touchcancel",a=>{this.isDragging&&(this.isDragging=!1,this.tileContainer.classList.remove("dragging-active"),this.resetTileTransforms())},{passive:!0});let a=!1;document.addEventListener("mousedown",b=>{b.target.closest("button")||this.isAnimating||(a=!0,this.isDragging=!0,this.dragStartX=b.clientX,this.dragStartY=b.clientY,this.currentDragX=this.dragStartX,this.currentDragY=this.dragStartY,this.dragDirection=null,this.dragDistance=0,this.dragStartTime=Date.now(),this.forceResetAllTiles(),this.tileContainer.classList.add("dragging-active"))}),document.addEventListener("mousemove",b=>{if(!a||!this.isDragging||this.isAnimating)return;let c=b.clientX-this.dragStartX,d=b.clientY-this.dragStartY;this.currentDragX=b.clientX,this.currentDragY=b.clientY;let e=Math.abs(c),f=Math.abs(d);(e>this.dragThreshold||f>this.dragThreshold)&&(e>f?(this.dragDirection=c>0?"right":"left",this.dragDistance=e):(this.dragDirection=d>0?"down":"up",this.dragDistance=f),this.updateDragPreview(c,d))}),document.addEventListener("mouseup",b=>{if(!a)return;a=!1,this.isDragging=!1,this.tileContainer.classList.remove("dragging-active");let c=Date.now()-this.dragStartTime<this.quickSwipeThreshold,d=c?.5*this.minDragDistance:this.minDragDistance;this.dragDirection&&this.dragDistance>d?c&&this.quickSwipeEnabled?(Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging"),a.style.transition="none",a.style.transform=""}),this.tileContainer.offsetHeight,Object.values(this.tiles).forEach(a=>{a.style.transition=""}),this.move(this.dragDirection)):this.transitionFromDragToMove(this.dragDirection):c?this.forceResetAllTiles():this.resetTileTransforms()})}handleSwipe(){let a=this.endX-this.startX,b=this.endY-this.startY;Math.abs(a)>Math.abs(b)?Math.abs(a)>30&&(a>0?this.move("right"):this.move("left")):Math.abs(b)>30&&(b>0?this.move("down"):this.move("up"))}move(a){if(this.isAnimating||this.isDragging)return;Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging")});let b=[],c=[],d=!1,e=[];for(let a=0;a<this.size;a++){e[a]=[];for(let b=0;b<this.size;b++)e[a][b]=null}if("left"===a)for(let a=0;a<this.size;a++){let f=this.processLine(this.getRow(a),a,0,0,1);d=f.moved||d,b.push(...f.movements),c.push(...f.merges),this.setRow(e,a,f.line)}else if("right"===a)for(let a=0;a<this.size;a++){let f=this.processLine(this.getRow(a).reverse(),a,3,0,-1);d=f.moved||d,b.push(...f.movements),c.push(...f.merges),this.setRow(e,a,f.line.reverse())}else if("up"===a)for(let a=0;a<this.size;a++){let f=this.processLine(this.getColumn(a),0,a,1,0);d=f.moved||d,b.push(...f.movements),c.push(...f.merges),this.setColumn(e,a,f.line)}else if("down"===a)for(let a=0;a<this.size;a++){let f=this.processLine(this.getColumn(a).reverse(),3,a,-1,0);d=f.moved||d,b.push(...f.movements),c.push(...f.merges),this.setColumn(e,a,f.line.reverse())}d&&(this.isAnimating=!0,this.grid=e,this.animateMovements(b,c,()=>{this.addNewTile(),this.saveState(),this.updateDisplay(),this.isAnimating=!1,this.checkWin()?this.showMessage("You Win!","game-won"):this.checkGameOver()&&(0===this.undoCount?this.showMessage("Game Over","game-over"):this.showMessage("Game Over","game-stuck"),this.onGameEnd&&this.onGameEnd(this.score,!1))}))}processLine(a,b,c,d,e){let f=[],g=[],h=[],i=!1,j=[];for(let b=0;b<a.length;b++)null!==a[b]&&j.push({tile:a[b],originalIndex:b});let k=0,l=0;for(;l<j.length;){let a=j[l],m=b+a.originalIndex*d,n=c+a.originalIndex*e,o=b+k*d,p=c+k*e;if((m!==o||n!==p)&&(f.push({tile:a.tile,from:{row:m,col:n},to:{row:o,col:p}}),i=!0),l+1<j.length&&a.tile.value===j[l+1].tile.value&&!a.tile.merged){let k={id:this.tileId++,value:2*a.tile.value,merged:!0},m=j[l+1],n=b+m.originalIndex*d,q=c+m.originalIndex*e;f.push({tile:m.tile,from:{row:n,col:q},to:{row:o,col:p}}),g.push({tiles:[a.tile,m.tile],result:k,position:{row:o,col:p}}),h.push(k),this.score+=k.value,i=!0,k.value>=this.undoRewardValue&&k.value%this.undoRewardValue==0&&this.earnUndoReward(),l+=2}else h.push(a.tile),l+=1;k++}for(;h.length<this.size;)h.push(null);return{line:h,moved:i,movements:f,merges:g}}getRow(a){return this.grid[a].slice()}setRow(a,b,c){a[b]=c}getColumn(a){let b=[];for(let c=0;c<this.size;c++)b.push(this.grid[c][a]);return b}setColumn(a,b,c){for(let d=0;d<this.size;d++)a[d][b]=c[d]}animateMovements(a,b,c){Object.values(this.tiles).forEach(a=>{a.style.transform&&(a.style.transform="")}),a.forEach(a=>{let b=this.tiles[a.tile.id];if(b){let{top:c,left:d}=this.getPosition(a.to.row,a.to.col);b.style.top=c,b.style.left=d}}),setTimeout(()=>{b.forEach(a=>{a.tiles.forEach(a=>{this.tiles[a.id]&&(this.tiles[a.id].remove(),delete this.tiles[a.id])}),this.createTileElement(a.position.row,a.position.col,a.result,!1,!0)}),b.length>0&&this.liquidBurst(),this.scoreDisplay.textContent=this.score,this.score>this.bestScore&&(this.bestScore=this.score,this.bestScoreDisplay.textContent=this.bestScore,localStorage.setItem("bestScore",this.bestScore)),setTimeout(c,30)},120)}addNewTile(){let a=[];for(let b=0;b<this.size;b++)for(let c=0;c<this.size;c++)null===this.grid[b][c]&&a.push({row:b,col:c});if(a.length>0){let b=a[Math.floor(this.random.random()*a.length)],c=.9>this.random.random()?2:4,d={id:this.tileId++,value:c,merged:!1};this.grid[b.row][b.col]=d,this.createTileElement(b.row,b.col,d,!0,!1)}}updateDisplay(){for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++)this.grid[a][b]&&this.grid[a][b].merged&&(this.grid[a][b].merged=!1);this.scoreDisplay.textContent=this.score,this.updateUndoButton()}earnUndoReward(){this.undoCount<this.maxUndoCount&&(this.undoCount++,this.showUndoReward())}showUndoReward(){let a=document.createElement("div");a.className="undo-reward",a.textContent="+1 Undo",document.querySelector(".score-container").appendChild(a),setTimeout(()=>{a.remove()},1e3)}updateUndoButton(){let a=document.querySelector(".btn-undo");if(a){let b=a.querySelector(".liquidGlass-content");b&&(b.textContent=`Undo (${this.undoCount})`),this.undoCount>0&&this.stateHistory.length>1?(a.disabled=!1,a.classList.remove("disabled")):(a.disabled=!0,a.classList.add("disabled"))}}createTileElement(a,b,c,d=!1,e=!1,f=!1){let g=document.createElement("div");g.className=`tile liquidGlass-wrapper tile-${c.value}`,g.id=`tile-${c.id}`,d&&g.classList.add("tile-new"),e&&g.classList.add("tile-merged"),f&&g.classList.add("tile-reappear");let h=document.createElement("div");h.className="liquidGlass-effect";let i=document.createElement("div");i.className="liquidGlass-tint";let j=document.createElement("div");j.className="liquidGlass-shine";let k=document.createElement("div");k.className="liquidGlass-text",k.textContent=c.value,g.appendChild(h),g.appendChild(i),g.appendChild(j),g.appendChild(k);let{top:l,left:m}=this.getPosition(a,b);g.style.top=l,g.style.left=m,this.tileContainer.appendChild(g),this.tiles[c.id]=g}getPosition(a,b){let c=window.innerWidth<=520?8:10,d=`(100% - ${3*c}px) / 4`;return{top:`calc(${d} * ${a} + ${c}px * ${a})`,left:`calc(${d} * ${b} + ${c}px * ${b})`}}checkWin(){for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++)if(this.grid[a][b]&&2048===this.grid[a][b].value)return!0;return!1}checkGameOver(){for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++)if(null===this.grid[a][b])return!1;for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++){let c=this.grid[a][b];if(c&&(b<this.size-1&&this.grid[a][b+1]&&c.value===this.grid[a][b+1].value||a<this.size-1&&this.grid[a+1][b]&&c.value===this.grid[a+1][b].value))return!1}return!0}saveState(){let a={grid:JSON.parse(JSON.stringify(this.grid)),score:this.score,undoCount:this.undoCount,randomSeed:this.random.getSeed(),tileId:this.tileId};if(this.stateHistory.length>0){let b=this.stateHistory[this.stateHistory.length-1];if(b.score===a.score&&b.tileId===a.tileId)return}this.stateHistory.push(a),this.stateHistory.length>this.maxHistorySize&&this.stateHistory.shift()}undo(){if(!this.isAnimating&&this.undoCount>0&&this.stateHistory.length>1){this.isAnimating=!0;let a=JSON.parse(JSON.stringify(this.grid));this.stateHistory.pop();let b=this.stateHistory[this.stateHistory.length-1],c=this.calculateUndoAnimations(a,b.grid);this.animateUndo(c,()=>{this.grid=JSON.parse(JSON.stringify(b.grid)),this.score=b.score,this.random.setSeed(b.randomSeed),this.tileId=b.tileId,this.undoCount--,this.updateDisplay(),this.updateUndoButton(),this.isAnimating=!1})}}calculateUndoAnimations(a,b){let c={movements:[],disappears:[],appears:[]},d=new Map,e=new Map;for(let b=0;b<this.size;b++)for(let c=0;c<this.size;c++)a[b][c]&&d.set(a[b][c].id,{tile:a[b][c],row:b,col:c});for(let a=0;a<this.size;a++)for(let c=0;c<this.size;c++)b[a][c]&&e.set(b[a][c].id,{tile:b[a][c],row:a,col:c});return e.forEach((a,b)=>{let e=d.get(b);e?(e.row!==a.row||e.col!==a.col)&&c.movements.push({tile:a.tile,from:{row:e.row,col:e.col},to:{row:a.row,col:a.col}}):c.appears.push({tile:a.tile,position:{row:a.row,col:a.col}})}),d.forEach((a,b)=>{e.has(b)||c.disappears.push({tile:a.tile,position:{row:a.row,col:a.col}})}),c}animateUndo(a,b){a.disappears.forEach(a=>{let b=this.tiles[a.tile.id];b&&b.classList.add("tile-disappear")}),a.movements.forEach(a=>{let b=this.tiles[a.tile.id];if(b){let{top:c,left:d}=this.getPosition(a.to.row,a.to.col);b.style.top=c,b.style.left=d}}),setTimeout(()=>{a.disappears.forEach(a=>{let b=this.tiles[a.tile.id];b&&(b.remove(),delete this.tiles[a.tile.id])}),this.tileContainer.innerHTML="",this.tiles={};let c=this.stateHistory[this.stateHistory.length-1];for(let b=0;b<this.size;b++)for(let d=0;d<this.size;d++)if(c.grid[b][d]){let e=a.appears.some(a=>a.tile.id===c.grid[b][d].id);this.createTileElement(b,d,c.grid[b][d],!1,!1,e)}setTimeout(b,50)},150)}restart(){this.tileContainer.innerHTML="",this.tiles={},this.grid=[],this.score=0,this.stateHistory=[],this.undoCount=this.initialUndoCount,this.tileId=0,this.randomSeed=Date.now(),this.random=this.createSeededRandom(this.randomSeed),this.hideMessage(),this.setup()}showMessage(a,b){this.messageContainer.innerHTML="";let c=document.createElement("p");if(c.textContent=a,this.messageContainer.appendChild(c),this.messageContainer.className="game-message "+b,"game-stuck"===b){let a=document.createElement("div");a.className="message-buttons";let b=document.createElement("button");b.className="restart-button",b.textContent=`Undo (${this.undoCount})`,b.onclick=()=>{this.hideMessage(),this.undo()};let c=document.createElement("button");c.className="restart-button",c.textContent="Try Again",c.onclick=()=>game.restart(),a.appendChild(b),a.appendChild(c),this.messageContainer.appendChild(a)}else if("game-won"!==b&&"game-over"!==b){let a=document.createElement("button");a.className="restart-button",a.textContent="Try Again",a.onclick=()=>game.restart(),this.messageContainer.appendChild(a)}else{let a=document.createElement("button");a.className="restart-button",a.textContent="Try Again",a.onclick=()=>game.restart(),this.messageContainer.appendChild(a)}this.messageContainer.style.display="flex",this.messageContainer.style.alignItems="center",this.messageContainer.style.justifyContent="center",this.messageContainer.style.flexDirection="column"}hideMessage(){this.messageContainer.style.display="none",this.messageContainer.className="game-message"}startLiquidAnimation(){}liquidBurst(){let a=document.querySelector("#liquid-burst feDisplacementMap");if(!a)return;let b=a.getAttribute("scale");a.setAttribute("scale","60"),setTimeout(()=>{a.setAttribute("scale",b)},300)}updateDragPreview(a,b){let c=this.tileContainer.offsetWidth/4+10,d=3.5*c,e=0,f=0;"left"===this.dragDirection||"right"===this.dragDirection?(e=Math.max(-d,Math.min(d,.7*a)),f=0):("up"===this.dragDirection||"down"===this.dragDirection)&&(e=0,f=Math.max(-d,Math.min(d,.7*b)));for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++){let d=this.grid[a][b];if(d&&this.tiles[d.id]){let g=this.tiles[d.id];if(this.canTileMove(a,b,this.dragDirection)){g.classList.contains("dragging")||g.classList.add("dragging");let d=Math.min(this.dragDistance/this.minDragDistance,1),h=d<.5?1.5*d:this.easeOutCubic(d),i=0;"left"===this.dragDirection?i=b*c:"right"===this.dragDirection?i=(this.size-1-b)*c:"up"===this.dragDirection?i=a*c:"down"===this.dragDirection&&(i=(this.size-1-a)*c);let j="left"===this.dragDirection||"right"===this.dragDirection?e:f,k=Math.sign(j)*Math.min(Math.abs(j*h),.9*i),l="left"===this.dragDirection||"right"===this.dragDirection?k:0,m="up"===this.dragDirection||"down"===this.dragDirection?k:0,n=Math.max(0,(d-.2)/.8),o=1+.02*n,p=("left"===this.dragDirection?-1:"right"===this.dragDirection?1:"up"===this.dragDirection?-.5:.5)*n*2;g.style.transform=`translate(${l}px, ${m}px) scale(${o}) rotate(${p}deg)`}else g.classList.remove("dragging"),g.style.transform="translate(0, 0) scale(1) rotate(0deg)"}}}easeOutCubic(a){return 1-Math.pow(1-a,3)}resetTileTransforms(){Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging"),a.classList.remove("moving"),a.style.transition="transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)",a.style.transform="translate(0, 0) scale(1) rotate(0deg)"})}forceResetAllTiles(){for(let a=0;a<this.size;a++)for(let b=0;b<this.size;b++){let c=this.grid[a][b];if(c&&this.tiles[c.id]){let d=this.tiles[c.id],{top:e,left:f}=this.getPosition(a,b);d.classList.remove("dragging","moving"),d.style.transition="none",d.style.transform="translate(0, 0) scale(1) rotate(0deg)",d.style.top=e,d.style.left=f,d.offsetHeight,d.style.transition=""}}Object.keys(this.tiles).forEach(a=>{let b=!1;for(let c=0;c<this.size&&!b;c++)for(let d=0;d<this.size&&!b;d++)this.grid[c][d]&&this.grid[c][d].id===parseInt(a)&&(b=!0);!b&&this.tiles[a]&&(this.tiles[a].remove(),delete this.tiles[a])})}animateTilesToTarget(a,b){this.isAnimating=!0;let c=[];for(let b=0;b<this.size;b++)for(let d=0;d<this.size;d++){let e=this.grid[b][d];if(e&&this.tiles[e.id]&&this.canTileMove(b,d,a)){let f=this.tiles[e.id],g=this.calculateMovement(b,d,a);g&&c.push({element:f,from:{row:b,col:d},to:g.to,distance:g.distance,willMerge:g.willMerge})}}let d=this.tileContainer.offsetWidth/4+10;c.forEach(b=>{let c=b.element,e=b.distance*d,f=0,g=0;switch(a){case"left":f=-e;break;case"right":f=e;break;case"up":g=-e;break;case"down":g=e}c.classList.remove("dragging"),c.style.transition="transform 0.12s cubic-bezier(0.25, 0.46, 0.45, 0.94)",c.style.transform=`translate(${f}px, ${g}px)`,b.willMerge&&(c.style.transform+=" scale(0.95)")}),setTimeout(()=>{this.resetTileTransforms(),this.isAnimating=!1,b&&b()},120)}calculateMovement(a,b,c){let d=this.grid[a][b];if(!d)return null;let e=a,f=b,g=0,h=!1;if("left"===c)for(let c=b-1;c>=0;c--)if(null===this.grid[a][c])f=c,g++;else if(this.grid[a][c].value!==d.value||this.grid[a][c].merged)break;else{f=c,g++,h=!0;break}else if("right"===c)for(let c=b+1;c<this.size;c++)if(null===this.grid[a][c])f=c,g++;else if(this.grid[a][c].value!==d.value||this.grid[a][c].merged)break;else{f=c,g++,h=!0;break}else if("up"===c)for(let c=a-1;c>=0;c--)if(null===this.grid[c][b])e=c,g++;else if(this.grid[c][b].value!==d.value||this.grid[c][b].merged)break;else{e=c,g++,h=!0;break}else if("down"===c)for(let c=a+1;c<this.size;c++)if(null===this.grid[c][b])e=c,g++;else if(this.grid[c][b].value!==d.value||this.grid[c][b].merged)break;else{e=c,g++,h=!0;break}return g>0?{to:{row:e,col:f},distance:g,willMerge:h}:null}canTileMove(a,b,c){if(!this.grid[a][b])return!1;switch(c){case"left":return b>0;case"right":return b<this.size-1;case"up":return a>0;case"down":return a<this.size-1;default:return!1}}transitionFromDragToMove(a){this.isAnimating=!0,Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging")});let b={};Object.keys(this.tiles).forEach(a=>{let c=this.tiles[a],d=window.getComputedStyle(c).transform;b[a]=d});let c=[],d=[],e=!1,f=[];for(let a=0;a<this.size;a++){f[a]=[];for(let b=0;b<this.size;b++)f[a][b]=null}if("left"===a)for(let a=0;a<this.size;a++){let b=this.processLine(this.getRow(a),a,0,0,1);e=b.moved||e,c.push(...b.movements),d.push(...b.merges),this.setRow(f,a,b.line)}else if("right"===a)for(let a=0;a<this.size;a++){let b=this.processLine(this.getRow(a).reverse(),a,3,0,-1);e=b.moved||e,c.push(...b.movements),d.push(...b.merges),this.setRow(f,a,b.line.reverse())}else if("up"===a)for(let a=0;a<this.size;a++){let b=this.processLine(this.getColumn(a),0,a,1,0);e=b.moved||e,c.push(...b.movements),d.push(...b.merges),this.setColumn(f,a,b.line)}else if("down"===a)for(let a=0;a<this.size;a++){let b=this.processLine(this.getColumn(a).reverse(),3,a,-1,0);e=b.moved||e,c.push(...b.movements),d.push(...b.merges),this.setColumn(f,a,b.line.reverse())}e?(this.grid=f,this.animateFromCurrentPosition(c,d,()=>{this.addNewTile(),this.saveState(),this.updateDisplay(),this.isAnimating=!1,this.checkWin()?this.showMessage("你赢了!","game-won"):this.checkGameOver()&&(0===this.undoCount?this.showMessage("游戏结束","game-over"):this.showMessage("无路可走!","game-stuck"))})):(this.resetTileTransforms(),setTimeout(()=>{this.isAnimating=!1},200))}animateFromCurrentPosition(a,b,c){Object.values(this.tiles).forEach(a=>{a.classList.remove("dragging"),a.classList.add("moving")});let d=this.tileContainer.offsetWidth/4+10,e=new Set;a.forEach(a=>{let b=this.tiles[a.tile.id];if(b){e.add(a.tile.id);let c=a.to.row-a.from.row,f=a.to.col-a.from.col;b.style.transform=`translate(${f*d}px, ${c*d}px)`}}),Object.entries(this.tiles).forEach(([a,b])=>{e.has(a)||(b.style.transform="translate(0, 0) scale(1) rotate(0deg)",b.classList.remove("moving"))}),setTimeout(()=>{a.forEach(a=>{let b=this.tiles[a.tile.id];if(b){let{top:c,left:d}=this.getPosition(a.to.row,a.to.col);b.style.transition="none",b.style.transform="translate(0, 0) scale(1) rotate(0deg)",b.style.top=c,b.style.left=d,b.offsetHeight,b.style.transition="",b.classList.remove("moving")}}),b.forEach(a=>{a.tiles.forEach(a=>{this.tiles[a.id]&&(this.tiles[a.id].remove(),delete this.tiles[a.id])}),this.createTileElement(a.position.row,a.position.col,a.result,!1,!0)}),b.length>0&&this.liquidBurst(),this.scoreDisplay.textContent=this.score,this.score>this.bestScore&&(this.bestScore=this.score,this.bestScoreDisplay.textContent=this.bestScore,localStorage.setItem("bestScore",this.bestScore)),setTimeout(()=>{this.forceResetAllTiles(),c()},30)},120)}}a.s(["Game2048",()=>b])}];

//# sourceMappingURL=src_components_Game_game-logic_ts_89157dc9._.js.map